(self.AMP=self.AMP||[]).push({n:"amp-access-poool",v:"2007102309000",f:(function(AMP,_){
var l;function m(){return l?l:l=Promise.resolve(void 0)};function n(){var a,b;this.promise=new Promise(function(c,d){a=c;b=d});this.resolve=a;this.reject=b};function q(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function t(a){var b=Object.create(null);if(!a)return b;for(var c;c=r.exec(a);){var d=q(c[1],c[1]),e=c[2]?q(c[2].replace(/\+/g," "),c[2]):"";b[d]=e}return b};var u="";
function v(){var a=self;if(a.__AMP_MODE)var b=a.__AMP_MODE;else{b=t(a.location.originalHash||a.location.hash);var c=t(a.location.search);u||(u=a.AMP_CONFIG&&a.AMP_CONFIG.v?a.AMP_CONFIG.v:"012007102309000");b={localDev:!1,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(b.development)||a.AMP_DEV_MODE),examiner:"2"==b.development,esm:!1,geoOverride:b["amp-geo"],minified:!0,lite:void 0!=c.amp_lite,test:!1,log:b.log,version:"2007102309000",rtvVersion:u};b=a.__AMP_MODE=b}return b};var w=self.AMP_CONFIG||{},x=("string"==typeof w.cdnProxyRegex?new RegExp(w.cdnProxyRegex):w.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function y(a){if(self.document&&self.document.head&&(!self.location||!x.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}w.cdnUrl||y("runtime-host");w.geoApiUrl||y("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var z=self.__AMP_LOG;function A(){if(!z.user)throw Error("failed to call initLogConstructor");return z.user}function B(){if(z.dev)return z.dev;throw Error("failed to call initLogConstructor");}function C(a,b,c,d,e,f){return A().assert(a,b,c,d,e,f,void 0,void 0,void 0,void 0,void 0)};function D(a){return a||{}};function E(){this.F=100;this.o=this.w=0;this.m=Object.create(null)}E.prototype.has=function(a){return!!this.m[a]};E.prototype.get=function(a){var b=this.m[a];if(b)return b.access=++this.o,b.payload};E.prototype.put=function(a,b){this.has(a)||this.w++;this.m[a]={payload:b,access:this.o};if(!(this.w<=this.F)){B().warn("lru-cache","Trimming LRU cache");a=this.m;var c=this.o+1,d;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.w--)}};D({c:!0,v:!0,a:!0,ad:!0,action:!0});var G,H;
function I(a){G||(G=self.document.createElement("a"),H=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new E));var b=H,c=G;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=
c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}function J(a,b,c){if(!b)return a;var d=a.split("#",2),e=d[0].split("?",2),f=e[0]+(e[1]?c?"?"+b+"&"+e[1]:"?"+e[1]+"&"+b:"?"+b);return f+=d[1]?"#"+d[1]:""}function aa(a,b){b=encodeURIComponent("iid")+"="+encodeURIComponent(b);return J(a,b,void 0)}
function ba(a,b){var c=[],d;for(d in b){var e=b[d];if(null!=e)if(Array.isArray(e))for(var f=0;f<e.length;f++){var g=e[f];c.push(encodeURIComponent(d)+"="+encodeURIComponent(g))}else c.push(encodeURIComponent(d)+"="+encodeURIComponent(e))}b=c.join("&");return J(a,b)};function K(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return L(a,b)}function M(a,b){var c=N(a);c=O(c);return L(c,b)}function N(a){return a.nodeType?K((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function O(a){a=N(a);return a.isSingleDoc()?a.win:a}function L(a,b){a=P(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function Q(a){var b=P(a).access;if(b){if(b.promise)return b.promise;L(a,"access");return b.promise=Promise.resolve(b.obj)}return null}function P(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function ca(){var a=new n,b=a.promise,c=a.resolve;a=a.reject;b.catch(function(){});return{obj:null,promise:b,resolve:c,reject:a,context:null,ctor:null}};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function da(a){return ea(a).then(function(a){return C(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access","amp-access","amp-access","amp-access")})}
function ea(a){var b=Q(O(a));if(b)return b;var c=N(a);return c.waitForBodyOpen().then(function(){var a=c.win;var b=c.win.document.head;if(b){var f={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(var g=0;g<b.length;g++){var k=b[g];k=k.getAttribute("custom-element")||k.getAttribute("custom-template");f[k]=!0}f=Object.keys(f)}else f=[];return f.includes("amp-access")?K(a,"extensions").waitForExtension(a,"amp-access"):m()}).then(function(){var b=c.win;if(b.__AMP_EXTENDED_ELEMENTS&&
b.__AMP_EXTENDED_ELEMENTS["amp-access"]){b=O(a);var e=Q(b);e?b=e:(b=P(b),b.access=ca(),b=b.access.promise)}else b=null;return b})};function fa(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}};function ha(a){if(!R(a))return null;var b=a.indexOf("{");try{return JSON.parse(a.substr(b))}catch(c){return B().error("MESSAGING","Failed to parse message: "+a,c),null}}function R(a){return"string"==typeof a&&0==a.indexOf("amp-")&&-1!=a.indexOf("{")};var S,U="Webkit webkit Moz moz ms O o".split(" ");function V(a,b,c){var d=a.style;if(2>b.length||0!=b.lastIndexOf("--",0)){S||(S=Object.create(null));var e=S[b];if(!e){e=b;if(void 0===d[b]){var f=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var g=0;g<U.length;g++){var k=U[g]+f;if(void 0!==d[k]){f=k;break b}}f=""}void 0!==d[f]&&(e=f)}S[b]=e}b=e}b&&((2>b.length?0:0==b.lastIndexOf("--",0))?a.style.setProperty(b,c):a.style[b]=c)}
function ia(a){for(var b=["transform"],c=0;c<b.length;c++)V(a,b[c],null)};function W(a,b,c){var d=a.listeningFors;!d&&c&&(d=a.listeningFors=Object.create(null));a=d||null;if(!a)return a;var e=a[b];!e&&c&&(e=a[b]=[]);return e||null}function ja(a,b){a=W(a,"amp",!0);for(var c,d=0;d<a.length;d++){var e=a[d];if(e.frame===b){c=e;break}}c||(c={frame:b,events:Object.create(null)},a.push(c));return c.events}
function ka(a){for(var b=D({sentinel:"unlisten"}),c=a.length-1;0<=c;c--){var d=a[c];if(!d.frame.contentWindow){a.splice(c,1);var e=d.events,f;for(f in e)e[f].splice(0,Infinity).forEach(function(a){a(b)})}}}
function la(a){a.listeningFors||a.addEventListener("message",function(b){if(b.data){var c=ma(b.data);if(c&&c.sentinel){var d=b.source;var e=W(a,c.sentinel);if(e){for(var f,g=0;g<e.length;g++){var k=e[g],F=k.frame.contentWindow;if(F){var h;if(!(h=d==F))b:{for(h=d;h&&h!=h.parent;h=h.parent)if(h==F){h=!0;break b}h=!1}if(h){f=k;break}}else setTimeout(ka,0,e)}d=f?f.events:null}else d=e;var T=d;if(T){var p=T[c.type];if(p)for(p=p.slice(),d=0;d<p.length;d++)(0,p[d])(c,b.source,b.origin,b)}}}})}
function X(a,b,c){function d(b,d,e,g){if("amp"==b.sentinel){if(d!=a.contentWindow)return;var h="null"==e&&void 0;if(f!=e&&!h)return}d==a.contentWindow&&("unlisten"==b.sentinel?k():c(b,d,e,g))}var e=a.ownerDocument.defaultView;la(e);e=ja(e,a);var f=I(a.src).origin,g=e[b]||(e[b]=[]);g.push(d);var k=function(){if(d){var a=g.indexOf(d);-1<a&&g.splice(a,1);c=g=d=null}}}
function ma(a){"string"==typeof a&&(a="{"==a.charAt(0)?fa(a,function(a){B().warn("IFRAME-HELPER","Postmessage could not be parsed. Is it in a valid JSON format?",a)})||null:R(a)?ha(a):null);return a};var Y={authorization:"https://api.poool.fr/api/v3/amp/access?rid=READER_ID",iframe:"https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER"};
function Z(a,b){this.ampdoc=a.ampdoc;this.l=b;this.B=M(this.ampdoc,"mutator");this.C=Y.authorization;this.G=Y.iframe;this.L=K(this.ampdoc.win,"timer");this.M=K(this.ampdoc.win,"xhr");this.H=M(this.ampdoc,"navigation");this.j=this.l.getAdapterConfig();this.D=this.j.bundleID||"";this.N="";this.A=this.j.itemID||"";this.h=this.ampdoc.win.document.createElement("iframe");this.h.setAttribute("id","poool-iframe");this.h.setAttribute("scrolling","no");this.h.setAttribute("frameborder","0");V(this.h,"width",
"100%");if("unlock"==this.j.forceWidget){var c=this.h,d={height:"250px",position:"fixed",bottom:"0"};for(e in d)V(c,e,d[e])}else{var e=this.h;d={height:"500px",transform:"translateY(-70px)"};for(c in d)V(e,c,d[c])}C(this.D,"BundleID is incorrect or not provided.");C(this.A,"ItemID is not provided.")}Z.prototype.authorize=function(){var a=this;return na(this).then(function(a){return{access:a.access}},function(b){if(!b||!b.response)throw b;if(402!==b.response.status)throw b;oa(a);return{access:!1}})};
function na(a){var b=aa(a.C,a.A);return a.l.buildUrl(b,!1).then(function(b){return a.l.getLoginUrl(b)}).then(function(b){B().info("amp-access-poool","Authorization URL: ",b);return a.L.timeoutPromise(3E3,a.M.fetchJson(b)).then(function(a){return a.json()})})}function pa(a){var b=a.ampdoc.getElementById("poool");return A().assertElement(b,"No element with id #poool found to render paywall into, got")}
function oa(a){var b=pa(a);a.l.buildUrl(ba(a.G,D({bi:a.j.bundleID,iid:a.j.itemID,ce:a.j.cookiesEnabled,d:"undefined"!==typeof a.j.debug&&null!==a.j.debug?a.j.debug:v().development||!1,fw:a.j.forceWidget,cs:a.j.customSegment})),!1).then(function(c){a.h.src=c;X(a.h,"release",a.J.bind(a));X(a.h,"resize",a.K.bind(a));X(a.h,"click",a.I.bind(a));b.appendChild(a.h)})}
Z.prototype.J=function(){var a=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");a&&this.B.mutateElement(a,function(){a.setAttribute("amp-access-hide","")});var b=this.ampdoc.getRootNode().querySelector("[poool-access-content]");b&&this.B.mutateElement(b,function(){b.removeAttribute("amp-access-hide")});ia(this.h)};Z.prototype.K=function(a){V(this.h,"height",a.height)};Z.prototype.I=function(a){a.url&&this.H.navigateTo(this.ampdoc.win,a.url)};Z.prototype.pingback=function(){return m()};(function(a){a.registerServiceForDoc("poool",function(a){a=a.getHeadNode();return da(a).then(function(a){var b=a.getVendorSource("poool"),c=new Z(a,b);b.getAdapter().registerVendor(c);return c})})})(self.AMP);
})});

//# sourceMappingURL=amp-access-poool-0.1.js.map
