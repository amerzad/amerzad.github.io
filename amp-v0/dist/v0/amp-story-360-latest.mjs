(self.AMP=self.AMP||[]).push({n:"amp-story-360",v:"2008290323002",f:function(AMP,_){let g;function h(){return g?g:g=Promise.resolve(void 0)}let k=self.AMP_CONFIG||{},l=("string"==typeof k.cdnProxyRegex?new RegExp(k.cdnProxyRegex):k.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function m(a){if(self.document&&self.document.head&&(!self.location||!l.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}k.cdnUrl||m("runtime-host");k.geoApiUrl||m("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};let n=self.__AMP_LOG;function p(){if(!n.user)throw Error("failed to call initLogConstructor");return n.user}function q(a,b){p().assert(a,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0});class r{constructor(){let a,b;this.promise=new Promise((c,d)=>{a=c;b=d});this.resolve=a;this.reject=b}}function t(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return u(a,b)}function v(a){var b=w(a);b=x(b);return u(b,"owners")}function w(a){return a.nodeType?t((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function x(a){a=w(a);return a.isSingleDoc()?a.win:a}function u(a,b){a=y(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function z(a,b){let c=A(a,b);if(c)return c;a=y(a);a[b]=B();return a[b].promise}function A(a,b){let c=y(a)[b];if(c){if(c.promise)return c.promise;u(a,b);return c.promise=Promise.resolve(c.obj)}return null}function y(a){let b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function B(){let a=new r,b=a.promise,c=a.resolve,d=a.reject;b.catch(()=>{});return{obj:null,promise:b,resolve:c,reject:d,context:null,ctor:null}}
/*
    https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function C(a,b,c){if(b(a))c();else{var d=a.ownerDocument.defaultView;if(d.MutationObserver){let e=new d.MutationObserver(()=>{b(a)&&(e.disconnect(),c())});e.observe(a,{childList:!0})}else{let e=d.setInterval(()=>{b(a)&&(d.clearInterval(e),c())},5)}}}function D(a,b){C(a.documentElement,()=>!!a.body,b)}function E(a){return new Promise(b=>D(a,b))}function F(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function G(a){var b=a.tagName;4>b.length||b.lastIndexOf("AMP-",0);if(a.createdCallback)return Promise.resolve(a);a.__AMP_UPG_PRM||(b=new r,a.__AMP_UPG_PRM=b.promise,a.__AMP_UPG_RES=b.resolve);return a.__AMP_UPG_PRM}function H(a){let b=A(a,"story-store");return b?b:I(a)}function I(a){return E(a.document).then(()=>{var b=a.document.head;if(b){var c={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(let a=0;a<b.length;a++){var d=b[a];d=d.getAttribute("custom-element")||d.getAttribute("custom-template");c[d]=!0}c=Object.keys(c)}else c=[];return c.includes("amp-story")?t(a,"extensions").waitForExtension(a,"amp-story"):h()}).then(()=>a.__AMP_EXTENDED_ELEMENTS&&a.__AMP_EXTENDED_ELEMENTS["amp-story"]?z(a,"story-store"):null)}function J(a,b){console.assert(9==a.length&&9==b.length);let c=new Float32Array(9);for(let d=0;3>d;++d)for(let e=0;3>e;++e){let f=0;for(let c=0;3>c;++c)f+=a[3*d+c]*b[3*c+e];c[3*d+e]=f}return c}function K(){let a=new Float32Array(9);a.fill(0);for(let b=0;3>b;++b)a[3*b+b]=1;return a}function L(a,b,c){console.assert(3>a&&3>b);let d=K(),e=Math.cos(c),f=Math.sin(c);d[3*a+a]=+e;d[3*a+b]=-f;d[3*b+a]=+f;d[3*b+b]=+e;return d}function M(a,b,c){a=a.gl;a.shaderSource(b,c);a.compileShader(b);let d=a.getShaderInfoLog(b);0<d.length&&console.log(d)}function N(a,b){a=a.gl;a.linkProgram(b);b=a.getProgramInfoLog(b);0<b.length&&console.log(b)}class O{constructor(a){let b={alpha:!0,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0},c=this.gl=a.getContext("webgl",b)||a.getContext("experimental-webgl",b);this.canvas=a;this.resize();this.rotation=null;this.scale=1;this.vertShader=c.createShader(c.VERTEX_SHADER);this.fragShaderFast=c.createShader(c.FRAGMENT_SHADER);this.fragShaderSlow=c.createShader(c.FRAGMENT_SHADER);this.progFast=c.createProgram();this.progSlow=c.createProgram();M(this,this.vertShader,"\n    uniform   vec2 uScale;\n    attribute vec2 aPos;\n    varying   vec2 vPos;\n\n    void main() {\n      gl_Position = vec4(aPos, 0.0, 1.0);\n      vPos = uScale * aPos;\n    }\n  ");c.attachShader(this.progFast,this.vertShader);c.attachShader(this.progFast,this.fragShaderFast);c.attachShader(this.progSlow,this.vertShader);c.attachShader(this.progSlow,this.fragShaderSlow);this.setMapping("\n    bool unproject(vec2 p, out vec3 q) {\n      q = vec3(p, -1.0);\n      return true;\n    }\n  ");this.setCamera(K(),1);this.vbo=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.vbo);let d=new Float32Array([-1,-1,1,-1,-1,1,1,1]);c.bufferData(c.ARRAY_BUFFER,d,c.STATIC_DRAW);this.tex=c.createTexture();c.bindTexture(c.TEXTURE_2D,this.tex);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.bindTexture(c.TEXTURE_2D,null);c.bindBuffer(c.ARRAY_BUFFER,null)}setImage(a){let b=this.gl;b.bindTexture(b.TEXTURE_2D,this.tex);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);b.bindTexture(b.TEXTURE_2D,null)}setMapping(a){M(this,this.fragShaderFast,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp   float;\n    #else\n      precision mediump float;\n    #endif\n\n    const   float     pi = 3.14159265359;\n    uniform float     uPxSize;\n    uniform mat3      uRot;\n    uniform sampler2D uTex;\n    varying vec2      vPos;\n\n    bool unproject(vec2, out vec3);\n\n    vec4 sample(float dx, float dy) {\n      vec2 p = vPos + uPxSize * vec2(dx, dy);\n      vec3 q;\n      if(unproject(p, q)) {\n        vec3 dir = normalize(uRot * q);\n        float u = (-0.5 / pi) * atan(dir[1], dir[0]) + 0.5;\n        float v = (1.0 / pi) * acos(dir[2]);\n        return texture2D(uTex, vec2(u, v));\n      }\n      else {\n        return vec4(0.0);\n      }\n    }\n  \n    void main() {\n      gl_FragColor = sample(0.0, 0.0);\n    }\n  "+a);M(this,this.fragShaderSlow,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp   float;\n    #else\n      precision mediump float;\n    #endif\n\n    const   float     pi = 3.14159265359;\n    uniform float     uPxSize;\n    uniform mat3      uRot;\n    uniform sampler2D uTex;\n    varying vec2      vPos;\n\n    bool unproject(vec2, out vec3);\n\n    vec4 sample(float dx, float dy) {\n      vec2 p = vPos + uPxSize * vec2(dx, dy);\n      vec3 q;\n      if(unproject(p, q)) {\n        vec3 dir = normalize(uRot * q);\n        float u = (-0.5 / pi) * atan(dir[1], dir[0]) + 0.5;\n        float v = (1.0 / pi) * acos(dir[2]);\n        return texture2D(uTex, vec2(u, v));\n      }\n      else {\n        return vec4(0.0);\n      }\n    }\n  \n    vec4 sampleSq(float dx, float dy) {\n      vec4 s = sample(dx, dy);\n      return vec4(s.xyz * s.xyz, s.w);\n    }\n\n    void main() {\n      // (2, 3) halton vector sequences.\n      vec4 acc = (1.0 / 16.0) * (\n        (((sampleSq( 1.0 /  2.0 - 0.5,  1.0 /  3.0 - 0.5) +\n           sampleSq( 1.0 /  4.0 - 0.5,  2.0 /  3.0 - 0.5)) +\n          (sampleSq( 3.0 /  4.0 - 0.5,  1.0 /  9.0 - 0.5) +\n           sampleSq( 1.0 /  8.0 - 0.5,  4.0 /  9.0 - 0.5))) +\n         ((sampleSq( 5.0 /  8.0 - 0.5,  7.0 /  9.0 - 0.5) +\n           sampleSq( 3.0 /  8.0 - 0.5,  2.0 /  9.0 - 0.5)) +\n          (sampleSq( 7.0 /  8.0 - 0.5,  5.0 /  9.0 - 0.5) +\n           sampleSq( 1.0 / 16.0 - 0.5,  8.0 /  9.0 - 0.5)))) +\n        (((sampleSq( 9.0 / 16.0 - 0.5,  1.0 / 27.0 - 0.5) +\n           sampleSq( 5.0 / 16.0 - 0.5, 10.0 / 27.0 - 0.5)) +\n          (sampleSq(13.0 / 16.0 - 0.5, 19.0 / 27.0 - 0.5) +\n           sampleSq( 3.0 / 16.0 - 0.5,  4.0 / 27.0 - 0.5))) +\n         ((sampleSq(11.0 / 16.0 - 0.5, 13.0 / 27.0 - 0.5) +\n           sampleSq( 7.0 / 16.0 - 0.5, 22.0 / 27.0 - 0.5)) +\n          (sampleSq(15.0 / 16.0 - 0.5,  7.0 / 27.0 - 0.5) +\n           sampleSq( 1.0 / 32.0 - 0.5, 16.0 / 27.0 - 0.5))))\n     );\n      gl_FragColor = vec4(sqrt(acc.xyz), acc.w);\n    }\n  "+a);N(this,this.progFast);N(this,this.progSlow)}setCamera(a,b){this.rotation=a;this.scale=b}resize(){let a=this.canvas.getBoundingClientRect();this.canvas.width=a.width*devicePixelRatio;this.canvas.height=a.height*devicePixelRatio;this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(a){let b=this.gl;b.disable(b.BLEND);let c=a?this.progFast:this.progSlow;b.useProgram(c);let d=this.scale/Math.sqrt(b.drawingBufferWidth*b.drawingBufferHeight),e=d*b.drawingBufferWidth,f=d*b.drawingBufferHeight;b.uniformMatrix3fv(b.getUniformLocation(c,"uRot"),!1,this.rotation);b.uniform2f(b.getUniformLocation(c,"uScale"),e,f);b.uniform1f(b.getUniformLocation(c,"uPxSize"),2*d);b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,this.vbo);b.vertexAttribPointer(0,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.tex);b.uniform1i(b.getUniformLocation(c,"uTex"),0);b.drawArrays(b.TRIANGLE_STRIP,0,4);b.bindTexture(b.TEXTURE_2D,null);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)}}let P;function Q(a){a=a.ownerDocument||a;P&&P.ownerDocument===a||(P=a.createElement("div"));return R}function R(a){var b=P;b.innerHTML=a[0];a=b.firstElementChild;b.removeChild(a);return b=a}
/*
    Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
    Use of this source code is governed by a BSD-style
    license that can be found in the LICENSE file or at
    https://developers.google.com/open-source/licenses/bsd */
function aa(a){let b=(a=a.toLowerCase().match(/^([0-9\.]+)\s*(s|ms)$/))?a[2]:void 0;return!a||3!==a.length||"s"!==b&&"ms"!==b?NaN:Math.round(("s"==b?1e3:1)*parseFloat(a?a[1]:void 0))}let ba=['<button class=i-amphtml-story-360-activate-button role=button><span class=i-amphtml-story-360-activate-text></span> <span class=i-amphtml-story-360-activate-button-icon>360° <svg class=i-amphtml-story-360-activate-button-icon-svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none><defs><linearGradient id=i-amphtml-story-360-activate-gradient><stop stop-color=white stop-opacity=.3></stop><stop offset=1 stop-color=white></stop></linearGradient><ellipse id=i-amphtml-story-360-activate-ellipse ry=11.5 rx=7.5 cy=12 cx=12 stroke=url(#i-amphtml-story-360-activate-gradient)></ellipse></defs><use xlink:href=#i-amphtml-story-360-activate-ellipse></use><use xlink:href=#i-amphtml-story-360-activate-ellipse transform="rotate(90, 12, 12)"></use></svg></span></button>'];function S(a,b,c){let d=a=>a*Math.PI/180;return new T(d(-b-90),d(90+a),1/c)}class T{constructor(a,b,c){this.theta=a;this.phi=b;this.scale=c}get rotation(){return J(L(1,2,this.theta),L(0,1,this.phi))}}class ca{constructor(a,b){this.maxFrame=.06*a;this.orientations=b;this.currentFrame=this.currentHeadingIndex=0;this.framesPerSection=this.maxFrame/(b.length-1)}getNextOrientation(){if(0>this.currentHeadingIndex||this.currentFrame==this.maxFrame-1)return null;this.currentFrame++;if(this.currentFrame>=(this.currentHeadingIndex+1)*this.framesPerSection)return this.currentHeadingIndex++,this.currentHeadingIndex==this.orientations.length?(this.currentHeadingIndex=-1,null):this.orientations[this.currentHeadingIndex];let a=this.orientations[this.currentHeadingIndex+1],b=this.orientations[this.currentHeadingIndex];if(!a)return this.currentHeadingIndex=-1,null;var c=this.currentFrame%this.framesPerSection/this.framesPerSection;c=.5>c?2*c*c:1-Math.pow(-2*c+2,2)/2;return new T(b.theta+(a.theta-b.theta)*c,b.phi+(a.phi-b.phi)*c,b.scale+(a.scale-b.scale)*c)}}function da(a){a.mutateElement(()=>{a.h&&(a.h.resize(),a.j||a.h.render(!1))})}function ea(a){null==a.C&&(a.C=F(a.element,a=>"amp-story-page"===a.tagName.toLowerCase()).getAttribute("id"));return a.C}function fa(a){"undefined"!==typeof a.win.DeviceOrientationEvent&&("undefined"===typeof a.win.DeviceOrientationEvent.requestPermission&&U(a),"function"===typeof a.win.DeviceOrientationEvent.requestPermission&&a.win.DeviceOrientationEvent.requestPermission().catch(()=>{ha(a)}).then(b=>{b&&V(a,b)}))}function U(a){a.w=!0;X(a);let b=a.H.delay(()=>{a.w=!1;a.o&&a.j&&Y(a)},1e3);let c;a.win.addEventListener("deviceorientation",d=>{a.o&&a.F&&(c&&a.win.cancelAnimationFrame(c),c=a.win.requestAnimationFrame(()=>{{let b=K();b=J(L(1,0,Math.PI/180*d.alpha),b);b=J(L(2,1,Math.PI/180*d.beta),b);b=J(L(0,2,Math.PI/180*d.gamma),b);a.h.setCamera(b,1);a.h.render(!0)}}));a.H.cancel(b)})}function X(a){a.mutateElement(()=>{a.element.classList.toggle("i-amphtml-story-360-hide-permissions-ui",!0)})}function ha(a){let b=Q(a.element)(ba);b.querySelector(".i-amphtml-story-360-activate-text").textContent=a.G.getLocalizedString("83");b.addEventListener("click",()=>ia(a));a.mutateElement(()=>a.element.appendChild(b))}function V(a,b){"granted"===b?a.D.dispatch("setGyroscopePermission","granted"):"denied"===b&&a.D.dispatch("setGyroscopePermission","denied")}function Y(a){a.m||(a.m=new ca(a.B,a.l));let b=()=>{if(a.j&&a.m&&!a.w){var c=a.m.getNextOrientation();c?a.win.requestAnimationFrame(()=>{a.h.setCamera(c.rotation,c.scale);a.h.render(!0);b()}):(a.j=!1,a.h.render(!1))}else a.h.render(!1)};a.mutateElement(()=>b())}function ia(a){a.win.DeviceOrientationEvent.requestPermission&&a.win.DeviceOrientationEvent.requestPermission().then(b=>{V(a,b)}).catch(a=>{if(n.dev)var b=n.dev;else throw Error("failed to call initLogConstructor");b.error("AMP_STORY_360",`Gyroscope permission error: ${a.message}`)})}function Z(a){a.mutateElement(()=>{a.h.setCamera(a.l[0].rotation,a.l[0].scale);a.h.render(!1)})}class ja extends AMP.BaseElement{constructor(a){super(a);this.G=null;this.l=[];this.B=0;this.m=this.h=this.A=null;this.w=this.o=this.j=!1;this.D=null;this.H=t(this.win,"timer");this.C=null;this.F=!1}buildCallback(){let a=a=>this.element.getAttribute(a);a("duration")&&(this.B=aa(a("duration"))||0);let b=parseFloat(a("heading-start")||0),c=parseFloat(a("pitch-start")||0),d=parseFloat(a("zoom-start")||1);this.l.push(S(b,c,d));if(void 0!==a("heading-end")||void 0!==a("pitch-end")||void 0!==a("zoom-end")){let e=parseFloat(a("heading-end")||b),W=parseFloat(a("pitch-end")||c),ka=parseFloat(a("zoom-end")||d);this.l.push(S(e,W,ka))}let e=this.element.ownerDocument.createElement("div");this.A=this.element.ownerDocument.createElement("canvas");this.element.appendChild(e);e.appendChild(this.A);this.applyFillContent(e,!0);return Promise.all([H(this.win).then(a=>{this.D=a;a.subscribe("pageSize",()=>da(this));a.subscribe("gyroscopePermissionState",a=>{"granted"===a?U(this):"denied"===a&&(this.w=!1,X(this))});a.subscribe("currentPageId",a=>{this.F=a===ea(this)})}),z(x(this.element),"localization").then(a=>{this.G=a})]).then(()=>{"gyroscope"===a("controls")&&fa(this);return h()})}isLayoutSupported(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a||"fluid"==a||"intrinsic"==a}layoutCallback(){let a=this.element.querySelector("amp-img");q(a,"amp-story-360 must contain an amp-img element.");let b=v(this.element);b.setOwner(a,this.element);b.scheduleLayout(this.element,a);return G(a).then(()=>a.signals().whenSignal("load-end")).then(()=>{this.h=new O(this.A);var a=this.element.querySelector("img");var b=document.createElement("canvas").getContext("webgl");b=b.getParameter(b.MAX_TEXTURE_SIZE);if(a.naturalWidth>b||a.naturalHeight>b){let c=document.createElement("canvas"),d=c.getContext("2d");c.width=Math.min(a.naturalWidth,b);c.height=Math.min(a.naturalHeight,b);d.drawImage(a,0,0,c.width,c.height);a=c}this.h.setImage(a);this.h.resize();1>this.l.length||(Z(this),this.o=!0,this.j&&Y(this))},()=>{p().error("AMP_STORY_360","Failed to load the amp-img.")})}get canAnimate(){return 0<this.B&&1<this.l.length}pause(){this.j=!1}play(){q(this.canAnimate,"amp-story-360 is either not configured to play an animation or still loading content.");this.j=!0;this.o&&Y(this)}rewind(){this.canAnimate&&(this.m=null,this.o&&this.win.requestAnimationFrame(()=>{Z(this);this.j&&Y(this)}))}}(a=>{a.registerElement("amp-story-360",ja,"amp-story-360 canvas{position:absolute;width:100%!important;height:100%!important}amp-story-360 amp-img{opacity:0!important}.i-amphtml-story-360-activate-button{position:absolute!important;bottom:8px!important;right:8px!important;background:rgba(0,0,0,0.8)!important;color:#fff!important;outline:none!important;border:none!important;padding:6px 6px 6px 10px!important;border-radius:18px!important;font-size:12px!important;font-family:Roboto,sans-serif!important}.i-amphtml-story-360-activate-button,.i-amphtml-story-360-activate-button-icon{display:-ms-flexbox!important;display:flex!important;-ms-flex-align:center!important;align-items:center!important}.i-amphtml-story-360-activate-button-icon{box-sizing:border-box!important;margin-left:5px!important;font-size:6px!important;width:24px!important;height:24px!important;border:1px solid #fff!important;border-radius:100%!important;-ms-flex-pack:center!important;justify-content:center!important;font-weight:700!important;position:relative!important}.i-amphtml-story-360-activate-button-icon-svg{position:absolute!important;width:calc(100% + 2px)!important;height:calc(100% + 2px)!important;left:-1px!important;top:-1px!important}[active] .i-amphtml-story-360-activate-button-icon-svg{animation:rotate 1s 1s!important}@keyframes rotate{to{transform:rotate(360deg)}}.i-amphtml-story-360-hide-permissions-ui .i-amphtml-story-360-activate-button{display:none!important}\n/*# sourceURL=/extensions/amp-story-360/0.1/amp-story-360.css*/")})(self.AMP)}});