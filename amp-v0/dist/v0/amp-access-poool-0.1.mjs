(self.AMP=self.AMP||[]).push({n:"amp-access-poool",v:"2008290323002",f:function(AMP,_){let k;function l(){return k?k:k=Promise.resolve(void 0)}class n{constructor(){let a,b;this.promise=new Promise((c,d)=>{a=c;b=d});this.resolve=a;this.reject=b}}let p=self.AMP_CONFIG||{},q=("string"==typeof p.cdnProxyRegex?new RegExp(p.cdnProxyRegex):p.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function r(a){if(self.document&&self.document.head&&(!self.location||!q.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}p.cdnUrl||r("runtime-host");p.geoApiUrl||r("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};let t=self.__AMP_LOG;function u(){if(!t.user)throw Error("failed to call initLogConstructor");return t.user}function v(a,b,c,d,e,f){return u().assert(a,b,c,d,e,f,void 0,void 0,void 0,void 0,void 0)}function w(a){return a||{}}class x{constructor(a){this.F=a;this.o=this.w=0;this.m=Object.create(null)}has(a){return!!this.m[a]}get(a){let b=this.m[a];if(b)return b.access=++this.o,b.payload}put(a,b){this.has(a)||this.w++;this.m[a]={payload:b,access:this.o};if(!(this.w<=this.F)){a=this.m;var c=this.o+1;for(let b in a){let{access:e}=a[b];if(e<c){c=e;var d=b}}void 0!==d&&(delete a[d],this.w--)}}}w({c:!0,v:!0,a:!0,ad:!0});let y,z;function A(a){y||(y=self.document.createElement("a"),z=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new x(100)));var b=z,c=y;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}function B(a,b,c){if(!b)return a;let d=a.split("#",2),e=d[0].split("?",2);let f=e[0]+(e[1]?c?`?${b}&${e[1]}`:`?${e[1]}&${b}`:`?${b}`);return f+=d[1]?`#${d[1]}`:""}function C(a,b){b=`${encodeURIComponent("iid")}=${encodeURIComponent(b)}`;return B(a,b,void 0)}function D(a,b){{let a=[];for(let d in b){var c=b[d];if(null!=c)if(Array.isArray(c))for(let b=0;b<c.length;b++){let e=c[b];a.push(`${encodeURIComponent(d)}=${encodeURIComponent(e)}`)}else a.push(`${encodeURIComponent(d)}=${encodeURIComponent(c)}`)}b=a.join("&")}return B(a,b)}function E(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return F(a,b)}function G(a,b){var c=H(a);c=I(c);return F(c,b)}function H(a){return a.nodeType?E((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function I(a){a=H(a);return a.isSingleDoc()?a.win:a}function F(a,b){a=J(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function K(a){let b=J(a).access;if(b){if(b.promise)return b.promise;F(a,"access");return b.promise=Promise.resolve(b.obj)}return null}function J(a){let b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function L(){let a=new n,b=a.promise,c=a.resolve,d=a.reject;b.catch(()=>{});return{obj:null,promise:b,resolve:c,reject:d,context:null,ctor:null}}
/*
    https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function M(a){return N(a).then(a=>v(a,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access","amp-access","amp-access","amp-access"))}function N(a){let b=K(I(a));if(b)return b;let c=H(a);return c.waitForBodyOpen().then(()=>{var a=c.win;var b=c.win.document.head;if(b){var f={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(let a=0;a<b.length;a++){var g=b[a];g=g.getAttribute("custom-element")||g.getAttribute("custom-template");f[g]=!0}f=Object.keys(f)}else f=[];return f.includes("amp-access")?E(a,"extensions").waitForExtension(a,"amp-access"):l()}).then(()=>{var b=c.win;if(b.__AMP_EXTENDED_ELEMENTS&&b.__AMP_EXTENDED_ELEMENTS["amp-access"]){b=I(a);let c=K(b);c?b=c:(b=J(b),b.access=L(),b=b.access.promise)}else b=null;return b})}function O(a,b){try{return JSON.parse(a)}catch(c){return b&&b(c),null}}function P(a){if(!Q(a))return null;let b=a.indexOf("{");try{return JSON.parse(a.substr(b))}catch(d){if(t.dev)var c=t.dev;else throw Error("failed to call initLogConstructor");c.error("MESSAGING","Failed to parse message: "+a,d);return null}}function Q(a){return"string"==typeof a&&0==a.indexOf("amp-")&&-1!=a.indexOf("{")}let R;let S="Webkit webkit Moz moz ms O o".split(" ");function T(a,b,c){var d=a.style;if(2>b.length||0!=b.lastIndexOf("--",0)){R||(R=Object.create(null));var e=R[b];if(!e){e=b;if(void 0===d[b]){var f=b.charAt(0).toUpperCase()+b.slice(1);b:{for(let a=0;a<S.length;a++){let b=S[a]+f;if(void 0!==d[b]){f=b;break b}}f=""}void 0!==d[f]&&(e=f)}R[b]=e}b=e}b&&((2>b.length?0:0==b.lastIndexOf("--",0))?a.style.setProperty(b,c):a.style[b]=c)}function U(a){var b=["transform"];for(let c=0;c<b.length;c++)T(a,b[c],null)}function V(a,b,c){{let{listeningFors:b}=a;!b&&c&&(b=a.listeningFors=Object.create(null));a=b||null}if(!a)return a;let d=a[b];!d&&c&&(d=a[b]=[]);return d||null}function W(a,b){a=V(a,"amp",!0);let c;for(let d=0;d<a.length;d++){let e=a[d];if(e.frame===b){c=e;break}}c||(c={frame:b,events:Object.create(null)},a.push(c));return c.events}function X(a){let b=w({sentinel:"unlisten"});for(let c=a.length-1;0<=c;c--){let d=a[c];if(!d.frame.contentWindow){a.splice(c,1);let e=d.events;for(let a in e)e[a].splice(0,1/0).forEach(a=>{a(b)})}}}function aa(a){a.listeningFors||a.addEventListener("message",(function(b){if(b.data){var c=ba(b.data);if(c&&c.sentinel){{var d=b.source;let m=V(a,c.sentinel);if(m){for(let a=0;a<m.length;a++){let b=m[a],c=b.frame.contentWindow;if(c){var e;if(!(e=d==c))b:{for(e=d;e&&e!=e.parent;e=e.parent)if(e==c){e=!0;break b}e=!1}if(e){var f=b;break}}else setTimeout(X,0,m)}var g=f?f.events:null}else g=m}if(g){var h=g[c.type];if(h)for(h=h.slice(),d=0;d<h.length;d++)(0,h[d])(c,b.source,b.origin,b)}}}}))}function Y(a,b,c){function d(b,d,e,g){if("amp"==b.sentinel){if(d!=a.contentWindow)return;let b="null"==e&&void 0;if(f!=e&&!b)return}d==a.contentWindow&&("unlisten"==b.sentinel?h():c(b,d,e,g))}var e=a.ownerDocument.defaultView;aa(e);e=W(e,a);let f=A(a.src).origin;let h,g=e[b]||(e[b]=[]);g.push(d);h=function(){if(d){let a=g.indexOf(d);-1<a&&g.splice(a,1);c=g=d=null}}}function ba(a){"string"==typeof a&&(a="{"==a.charAt(0)?O(a,()=>{})||null:Q(a)?P(a):null);return a}let Z={authorization:"https://api.poool.fr/api/v3/amp/access?rid=READER_ID",iframe:"https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER"};function ca(a){let b=C(a.C,a.A);return a.l.buildUrl(b,!1).then(b=>a.l.getLoginUrl(b)).then(b=>a.L.timeoutPromise(3e3,a.M.fetchJson(b)).then(a=>a.json()))}function da(a){let b=ea(a);a.l.buildUrl(D(a.G,w({bi:a.j.bundleID,iid:a.j.itemID,ce:a.j.cookiesEnabled,d:"undefined"!==typeof a.j.debug&&null!==a.j.debug?a.j.debug:!1,fw:a.j.forceWidget,cs:a.j.customSegment})),!1).then(c=>{a.h.src=c;Y(a.h,"release",a.J.bind(a));Y(a.h,"resize",a.K.bind(a));Y(a.h,"click",a.I.bind(a));b.appendChild(a.h)})}function ea(a){let b=a.ampdoc.getElementById("poool");return u().assertElement(b,"No element with id #poool found to render paywall into, got")}class fa{constructor(a,b){this.ampdoc=a.ampdoc;this.l=b;this.B=G(this.ampdoc,"mutator");this.C=Z.authorization;this.G=Z.iframe;this.L=E(this.ampdoc.win,"timer");this.M=E(this.ampdoc.win,"xhr");this.H=G(this.ampdoc,"navigation");this.j=this.l.getAdapterConfig();this.D=this.j.bundleID||"";this.N="";this.A=this.j.itemID||"";this.h=this.ampdoc.win.document.createElement("iframe");this.h.setAttribute("id","poool-iframe");this.h.setAttribute("scrolling","no");this.h.setAttribute("frameborder","0");T(this.h,"width","100%");if("unlock"==this.j.forceWidget){var c=this.h,d={height:"250px",position:"fixed",bottom:"0"};for(var e in d)T(c,e,d[e])}else for(c in e=this.h,d={height:"500px",transform:"translateY(-70px)"},d)T(e,c,d[c]);v(this.D,"BundleID is incorrect or not provided.");v(this.A,"ItemID is not provided.")}authorize(){return ca(this).then(a=>({access:a.access}),a=>{if(!a||!a.response)throw a;if(402!==a.response.status)throw a;da(this);return{access:!1}})}J(){let a=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");a&&this.B.mutateElement(a,()=>{a.setAttribute("amp-access-hide","")});let b=this.ampdoc.getRootNode().querySelector("[poool-access-content]");b&&this.B.mutateElement(b,()=>{b.removeAttribute("amp-access-hide")});U(this.h)}K(a){T(this.h,"height",a.height)}I(a){a.url&&this.H.navigateTo(this.ampdoc.win,a.url)}pingback(){return l()}}(function(a){a.registerServiceForDoc("poool",(function(a){a=a.getHeadNode();return M(a).then(a=>{let b=a.getVendorSource("poool"),c=new fa(a,b);b.getAdapter().registerVendor(c);return c})}))})(self.AMP)}});