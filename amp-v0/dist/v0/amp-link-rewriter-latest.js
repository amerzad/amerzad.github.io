(self.AMP=self.AMP||[]).push({n:"amp-link-rewriter",v:"2007102309000",f:(function(AMP,_){
var l="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function n(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object");})()}n(this);"function"===typeof Symbol&&Symbol("x");var r;
if("function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var t;a:{var u={a:!0},w={};try{w.__proto__=u;t=w.a;break a}catch(a){}t=!1}r=t?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var x=r;function y(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var z=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;var B=self.AMP_CONFIG||{},C=("string"==typeof B.cdnProxyRegex?new RegExp(B.cdnProxyRegex):B.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function D(a){if(self.document&&self.document.head&&(!self.location||!C.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}B.cdnUrl||D("runtime-host");B.geoApiUrl||D("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var E=self.__AMP_LOG;function F(a){E.user||(E.user=H());var b=E.user.win;return a&&a.ownerDocument.defaultView!=b?E.userForEmbed?E.userForEmbed:E.userForEmbed=H():E.user}function H(){throw Error("failed to call initLogConstructor");};var I=Object.prototype.hasOwnProperty;function J(a){if(a.__AMP__EXPERIMENT_TOGGLES)return a.__AMP__EXPERIMENT_TOGGLES;a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);var b=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var c in a.AMP_CONFIG){var d=a.AMP_CONFIG[c];"number"===typeof d&&0<=d&&1>=d&&(b[c]=Math.random()<d)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length){var m=a.AMP_CONFIG["allow-doc-opt-in"],g=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]');
if(g){var h=g.getAttribute("content").split(",");for(c=0;c<h.length;c++)-1!=m.indexOf(h[c])&&(b[h[c]]=!0)}}Object.assign(b,K(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){c=a.AMP_CONFIG["allow-url-opt-in"];var k=a.location.originalHash||a.location.hash;a=Object.create(null);if(k)for(var e;e=z.exec(k);){var q=y(e[1],e[1]);e=e[2]?y(e[2].replace(/\+/g," "),e[2]):"";a[q]=e}for(k=0;k<c.length;k++)q=a["e-"+c[k]],"1"==q&&(b[c[k]]=!0),"0"==
q&&(b[c[k]]=!1)}return b}function K(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(m){if(E.dev)a=E.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var d=0;d<c.length;d++)0!=c[d].length&&("-"==c[d][0]?a[c[d].substr(1)]=!1:a[c[d]]=!0);return a};var L=[{experimentId:"ampdoc-fie",isTrafficEligible:function(){return!0},branches:["21065001","21065002"]}];function M(a,b){var c=N(a);c=O(c);return P(c,b)}function N(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=P(b,"ampdoc").getAmpDoc(a)}return a}function O(a){a=N(a);return a.isSingleDoc()?a.win:a}function P(a,b){Q(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function Q(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var R;function S(a){function b(a){return a}var c=T,d=a.dataset;a={};var m=c?c:/^param(.+)/,g;for(g in d){var h=g.match(m);h&&(h=h[1][0].toLowerCase()+h[1].substr(1),a[b(h)]=d[g])}return a}function aa(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)};function ba(a){var b={};Object.keys(a).forEach(function(c){b[c]="^"+a[c]+"$"});return b};function ca(a,b){var c=a.getRootNode(),d=b.section.join(" a, "),m=c.querySelectorAll("a"),g=[];0!==b.section.length&&(d+=" a",m=c.querySelectorAll(d));aa(m,function(a){da(a,b)&&g.push(a)});return g}function da(a,b){var c=b.attribute;return Object.keys(c).every(function(b){return(new RegExp(c[b])).test(a.getAttribute(b))})};var ea=["href","id","rel","rev"],T=/^vars(.+)/,U=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,fa={SOURCE_URL:!0,DOCUMENT_REFERRER:!0};
function V(a,b,c){this.j=c;try{/^[\w-]+$/.test("script");if(void 0!==R)var d=R;else{try{var m=b.ownerDocument,g=m.createElement("div"),h=m.createElement("div");g.appendChild(h);var k=g.querySelector(":scope div")===h}catch(G){k=!1}d=R=k}if(d)var e=b.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{b.classList.add("i-amphtml-scoped");var q="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),ha=b.querySelectorAll(q);b.classList.remove("i-amphtml-scoped");e=ha}var p=e;if(1!==p.length)throw Error("Found "+
p.length+" <script> children. Expected 1.");var A=p[0];if("SCRIPT"!=A.tagName||!A.hasAttribute("type")||"APPLICATION/JSON"!=A.getAttribute("type").toUpperCase())throw Error('<script> child must have type="application/json"');try{var f=JSON.parse(A.textContent)}catch(G){throw Error("Failed to parse <script> contents. Is it valid JSON?");}var v=f}catch(G){throw F(b).createError("%s: %s","amp-link-rewriter",G);}c=v;v=c.output;F().assert(v,"amp-link-rewriter: output config property is required",void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0);this.l={output:c.output.toString(),section:I.call(c,"section")?c.section:[],attribute:I.call(c,"attribute")?ba(c.attribute):{},vars:I.call(c,"vars")?c.vars:{}};this.m=ca(this.j,this.l);this.h=a;this.c="";c=b.ownerDocument.defaultView;f=c.__AMP_TOP||(c.__AMP_TOP=c);v=c!=f;if(J(f)["ampdoc-fie"]){f.__AMP_EXPERIMENT_BRANCHES=f.__AMP_EXPERIMENT_BRANCHES||{};for(p=0;p<L.length;p++)d=L[p],e=d.experimentId,I.call(f.__AMP_EXPERIMENT_BRANCHES,e)||(d.isTrafficEligible&&
d.isTrafficEligible(f)?!f.__AMP_EXPERIMENT_BRANCHES[e]&&J(f)[e]&&(d=d.branches,f.__AMP_EXPERIMENT_BRANCHES[e]=d[Math.floor(Math.random()*d.length)]||null):f.__AMP_EXPERIMENT_BRANCHES[e]=null);f="21065002"===(f.__AMP_EXPERIMENT_BRANCHES?f.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else f=!1;v&&!f?c=Q(c,"url-replace")?P(c,"url-replace"):null:(c=N(b),c=O(c),c=Q(c,"url-replace")?P(c,"url-replace"):null);this.A=c}
V.prototype.handleClick=function(a){if(a&&(this.c=this.l.output,a.href.match(U)[1]!==this.c.match(U)[1]&&ia(this,a))){var b=M(this.j,"documentInfo").get().sourceUrl.match(U)[1],c=M(this.j,"documentInfo").get().canonicalUrl.match(U)[1];if(!ja(a,[b,c])){this.c=this.A.expandUrlSync(this.c,{DOCUMENT_REFERRER:this.h},fa);var d=this.l.vars;d instanceof Object&&(a.href=ka(this,a,d))}}};function ia(a,b){return null===a.m||0===a.m.length||0<a.m.filter(function(a){return a===b}).length?!0:!1}
function ja(a,b){var c=a.href;return b.some(function(a){var b=c.match(U);return b?U.test(c)&&b[1]===a:!0})}function ka(a,b,c){ea.forEach(function(a){b.getAttribute(a)&&(c[a]=b.getAttribute(a))});var d=S(b);Object.assign(c,d);c.random=Math.random().toString(32).substr(2);Object.keys(c).forEach(function(b){c[b]&&(a.c=a.c.replace("${"+b+"}",encodeURIComponent(c[b])))});a.c=a.c.replace(/\${[A-Za-z0-9]+}+/,function(){return""});return a.c};function W(a){a=AMP.BaseElement.call(this,a)||this;a.o=null;a.h="";return a}var X=AMP.BaseElement;W.prototype=l(X.prototype);W.prototype.constructor=W;if(x)x(W,X);else for(var Y in X)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(X,Y);Z&&Object.defineProperty(W,Y,Z)}else W[Y]=X[Y];W.B=X.prototype;
W.prototype.buildCallback=function(){var a=this,b=M(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then(function(){return b.getReferrerUrl()}).then(function(b){return a.h=b}).then(this.w.bind(this))};W.prototype.w=function(){this.o=new V(this.h,this.element,this.getAmpDoc());la(this)};function la(a){M(a.getAmpDoc(),"navigation").registerAnchorMutator(function(b){a.o.handleClick(b)},0)}W.prototype.isLayoutSupported=function(a){return"nodisplay"===a};
(function(a){a.registerElement("amp-link-rewriter",W)})(self.AMP);
})});

//# sourceMappingURL=amp-link-rewriter-0.1.js.map
