{"version":3,"sources":["extensions/amp-viewer-integration/0.1/messaging/messaging.js","extensions/amp-viewer-integration/0.1/examples/amp-viewer-host.js"],"names":["parseMessage","message","JSON","e","constructor","WindowPortEmulator","win","origin","target","win_","origin_","target_","addEventListener","eventType","handler","event","postMessage","data","targetOrigin","start","Messaging","port","port_","isWebview_","token_","verifyToken_","requestIdCounter_","waitingForResponse_","messageHandlers_","defaultHandler_","handleMessage_","bind","initiateHandshakeWithDocument","Promise","resolve","intervalRef","setInterval","APP","CHANNEL_OPEN_MSG","clearInterval","listener","messaging","channel","MessageChannel","pollMessage","app","name","HANDSHAKE_POLL_MSG","waitForHandshakeFromDocument","source","registerHandler","messageName","requestHandler","unregisterHandler","setDefaultHandler","logError_","TAG","REQUEST","handleRequest_","RESPONSE","requestId","pending","handleResponse_","Error","sendRequest","messageData","awaitResponse","promise","undefined","reject","sendMessage_","requestid","type","rsvp","sendResponse_","sendResponseError_","reason","errString","err","String","error","finalMessage","Object","state","opt_data","stateStr","AmpViewerHost","ampIframe","frameOrigin","messageHandler","opt_logsId","opt_isWebview","opt_isHandshakePoll","ampIframe_","messageHandler_","logsId","contentWindow","messaging_","completeHandshake_","visibilityState_","prerenderSize","log","var_args","Array","arguments","console","self"],"mappings":"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","file":"amp-viewer-host.js","sourceRoot":"https://raw.githubusercontent.com/ampproject/amphtml/2007102309000/"}