(self.AMP=self.AMP||[]).push({n:"amp-viewer-integration",p:"high",v:"2007102309000",f:(function(AMP,_){
var m;function p(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var aa=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function ba(a){var b=!1,c=null,d=a;return function(a){for(var e=[],f=0;f<arguments.length;++f)e[f-0]=arguments[f];b||(c=d.apply(self,e),b=!0,d=null);return c}};var q=self.AMP_CONFIG||{},r=("string"==typeof q.cdnProxyRegex?new RegExp(q.cdnProxyRegex):q.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function t(a){if(!self.document||!self.document.head||self.location&&r.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}
var ca={thirdParty:q.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:q.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof q.thirdPartyFrameRegex?new RegExp(q.thirdPartyFrameRegex):q.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:q.cdnUrl||t("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:r,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:q.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:q.betaErrorReportingUrl||
"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:q.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:q.geoApiUrl||t("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var u=self.__AMP_LOG;function v(){if(u.dev)return u.dev;throw Error("failed to call initLogConstructor");}function w(a,b,c){if(!u.user)throw Error("failed to call initLogConstructor");u.user.assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)};function x(a){return a||{}};function y(){this.ca=100;this.H=this.S=0;this.D=Object.create(null)}y.prototype.has=function(a){return!!this.D[a]};y.prototype.get=function(a){var b=this.D[a];if(b)return b.access=++this.H,b.payload};y.prototype.put=function(a,b){this.has(a)||this.S++;this.D[a]={payload:b,access:this.H};if(!(this.S<=this.ca)){v().warn("lru-cache","Trimming LRU cache");a=this.D;var c=this.H+1,d;for(d in a){var f=a[d].access;if(f<c){c=f;var e=d}}void 0!==e&&(delete a[e],this.S--)}};var da=x({c:!0,v:!0,a:!0,ad:!0,action:!0}),z,A,ea=/[?&]amp_js[^&]*/,ha=/[?&]amp_gsa[^&]*/,ia=/[?&]amp_r[^&]*/,ja=/[?&]amp_kit[^&]*/,ka=/[?&]usqp[^&]*/;
function B(a){z||(z=self.document.createElement("a"),A=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new y));var b=A,c=z;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=
c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}
function la(a){"string"==typeof a&&(a=B(a));var b=a;"string"==typeof b&&(b=B(b));if(!ca.cdnProxyRegex.test(b.origin))return a.href;b=a.pathname.split("/");w(da[b[1]],"Unknown path prefix in url %s",a.href);var c=b[2],d="s"==c?"https://"+decodeURIComponent(b[3]):"http://"+decodeURIComponent(c);w(0<d.indexOf("."),"Expected a . in origin %s",d);b.splice(1,"s"==c?3:2);b=d+b.join("/");d=(d=a.search)&&"?"!=d?(d=d.replace(ea,"").replace(ha,"").replace(ia,"").replace(ja,"").replace(ka,"").replace(/^[?&]/,
""))?"?"+d:"":"";return b+d+(a.hash||"")};function C(a,b){var c=D(a);c=D(c);c=c.isSingleDoc()?c.win:c;return E(c,b)}function D(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=E(b,"ampdoc").getAmpDoc(a)}return a}function E(a,b){var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function ma(a){return a.parent&&a.parent!=a};var F,G="Webkit webkit Moz moz ms O o".split(" ");function H(a,b,c){var d=a.style;if(2>b.length||0!=b.lastIndexOf("--",0)){F||(F=Object.create(null));var f=F[b];if(!f){f=b;if(void 0===d[b]){var e=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var g=0;g<G.length;g++){var h=G[g]+e;if(void 0!==d[h]){e=h;break b}}e=""}void 0!==d[e]&&(f=e)}F[b]=f}b=f}b&&((2>b.length?0:0==b.lastIndexOf("--",0))?a.style.setProperty(b,c):a.style[b]=c)}function I(a,b){for(var c in b)H(a,c,b[c])};var J;function K(a,b,c,d){var f=a,e=c;var g=function(a){try{return e(a)}catch(n){throw self.__AMP_REPORT_ERROR(n),n;}};var h=na(),k=!1;d&&(k=d.capture);f.addEventListener(b,g,h?d:k);return function(){f&&f.removeEventListener(b,g,h?d:k);g=f=e=null}}function na(){if(void 0!==J)return J;J=!1;try{var a={get capture(){J=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return J};function L(a,b,c,d){return K(a,b,c,d)}function M(a,b,c){var d=c,f=K(a,b,function(a){try{d(a)}finally{d=null,f()}},void 0)};function oa(a,b){this.win=a;this.A=b;L(this.win.document,"focusin",this.I.bind(this),{capture:!1})}oa.prototype.I=function(a){a.defaultPrevented||this.A.sendRequest(a.type,x({focusTargetRect:a.target.getBoundingClientRect()}),!1)};function N(a){this.L=a;this.C=[];this.F=0}N.prototype.push=function(a){this.C[this.F]=a;this.F=(this.F+1)%this.L};N.prototype.get=function(a){this.C.length>=this.L&&(a=(this.F+a)%this.L);return this.C[a]};N.prototype.size=function(){return this.C.length};var pa=/[,.\s\u2022()]/;function qa(a){return"\u2019"==a||"\u2018"==a?"'":"\u201c"==a||"\u201d"==a?'"':a.toLowerCase()}
function ra(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],f=[],e=0;e<d.length;e++){var g=d[e];pa.test(g)||f.push(qa(g))}var h=f.join("");h&&b.push(h)}return b}function O(a,b){this.ia=a;this.ba=b;this.matches=[];this.Z={};this.T=a.length-1;for(b=0;b<a.length;b++)this.Z[a[b]]=a.length-1-b}
O.prototype.update=function(){if(0<this.T)this.T--;else{for(var a=this.ia,b=this.ba,c=b.size(),d=0;d<a.length;d++){var f=b.get(c-1-d).pos;f=qa(f.node.wholeText[f.offset]);if(a[a.length-1-d]!=f){var e=this.Z[f];null==e&&(e=a.length);e-=d;1>e&&(e=1);this.T=e-1;return}}var g=b.get(c-1),h=g.pos;this.matches.push({start:b.get(c-a.length),end:{pos:{node:h.node,offset:h.offset+1},idx:g.idx+1}})}};
function sa(a,b,c){c=ra(c);if(0>=c.length)return null;var d=new P(a,b);a=new N(c.map(function(a){return a.length}).reduce(function(a,b){return Math.max(a,b)}));for(var f=[new O(c[0],a)],e=-1;;){e++;b=d.next();if(null==b)return null;if(!pa.test(b.node.wholeText[b.offset])){a.push({pos:b,idx:e});for(b=0;b<f.length;b++)f[b].update();if(0!=f[f.length-1].matches.length){if(f.length==c.length)break;f.push(new O(c[f.length],a))}}}a=[];c=c.length-1;a:for(;0<=c;c--){var g=f[c].matches;if(0==a.length)a.push(g[g.length-
1]);else{var h=a[a.length-1];for(b=g.length-1;0<=b;b--){var k=g[b];if(h.start.idx>=k.end.idx){a.push(k);continue a}}}}c=[];for(b=a.length-1;0<=b;b--)k=a[b],c.push({start:k.start.pos,end:k.end.pos});return c}
function ta(a,b,c,d,f){if(c>=d)return null;a=a.document;var e=b.parentNode,g=b.wholeText;0<c&&e.insertBefore(a.createTextNode(g.substring(0,c)),b);var h=a.createElement("span");h.appendChild(a.createTextNode(g.substring(c,d)));e.insertBefore(h,b);f.push(h);var k=null;d<g.length&&(k=a.createTextNode(g.substring(d)),e.insertBefore(k,b));e.removeChild(b);return k}
function P(a,b){this.o=a;this.N=b;this.B=-1;this.w=null;b instanceof a.Text?this.B=0:b instanceof a.Element&&"none"!=(a.getComputedStyle(b)||Object.create(null)).display&&(b=b.firstChild,null!=b&&(this.w=new P(a,b)))}P.prototype.next=function(){if(0<=this.B){if(this.B<this.N.wholeText.length){var a=this.B;this.B++;a={node:this.N,offset:a}}else a=null;return a}for(;null!=this.w;){a=this.w.next();if(null!=a)return a;var b=this.w.N.nextSibling;this.w=null!=b?new P(this.o,b):null}return null};function ua(a){return"loading"!=a.readyState&&"uninitialized"!=a.readyState}function va(a,b){var c=ua(a);if(c)b(a);else{var d=function(){ua(a)&&(c||(c=!0,b(a)),a.removeEventListener("readystatechange",d))};a.addEventListener("readystatechange",d)}}function wa(a){return new Promise(function(b){va(a,b)})};function xa(a){a=a.win.location.hash;var b=Object.create(null);if(a)for(var c;c=aa.exec(a);){var d=p(c[1],c[1]);c=c[2]?p(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}a=b.highlight;if(!a||102400<a.length)return null;var f=JSON.parse(a),e=f.s;if(!(e instanceof Array)||15<e.length)return null;var g=0;for(a=0;a<e.length;a++){b=e[a];if("string"!=typeof b||!b)return null;g+=b.length;if(1500<g)return null}var h=!1;f.n&&(h=!0);var k=!1;f.na&&(k=!0);return{sentences:e,skipScrollAnimation:k,skipRendering:h}}
function Q(a,b){var c=this;this.h=a;this.ja=C(a,"viewer");this.l=C(this.h,"viewport");this.j=null;wa(a.win.document).then(function(){ya(c,b)})}function R(a,b,c){b=x({state:b});for(var d in c)b[d]=c[d];a.ja.sendMessage("highlightState",b)}
function za(a,b){var c=a.h.win;if(b=sa(c,a.h.getBody(),b.sentences)){for(var d=[],f=null,e=0;e<b.length;e++){var g=b[e];f&&f.end.node==g.start.node&&f.end.offset==g.start.offset?f.end=g.end:(f=g,d.push(g))}b=d;d=[];for(f=0;f<b.length;f++){e=b[f];var h=e.start,k=e.end;g=b;for(e=f;;){if(h.node==k.node){if(h=ta(c,h.node,h.offset,k.offset,d))for(e+=1;e<g.length;e++){var l=g[e];if(k.node!=l.start.node)break;l.start.node=h;l.start.offset-=k.offset;if(k.node!=l.end.node)break;l.end.node=h;l.end.offset-=
k.offset}break}a:{l=!0;for(var n=h.node;;){if(null==n){l=null;break a}if(l){var fa=n.nextSibling;fa?(n=fa,l=!1):n=n.parentNode}else{if(n instanceof c.Text){l=n;break a}n.firstChild?n=n.firstChild:l=!0}}}ta(c,h.node,h.offset,h.node.wholeText.length,d);if(!l)break;h={node:l,offset:0}}}d&&0!=d.length&&(a.j=d)}}Q.prototype.onVisibleOnce=function(a){var b=this;a=ba(a);this.h.onVisibilityChanged(function(){"visible"==b.h.getVisibilityState()&&a()})};
function ya(a,b){if(a.h.win.document.querySelector('script[id="amp-access"]'))R(a,"has_amp_access");else if(za(a,b),a.j){var c=S(a);R(a,"found",x({scroll:c}));if(!b.skipRendering){for(var d=0;d<a.j.length;d++)I(a.j[d],{backgroundColor:"#fcff00",color:"#000"});var f=a.h.getVisibilityState();b.skipScrollAnimation?"visible"==f?Aa(a,c):(a.l.setScrollTop(c),a.onVisibleOnce(function(){Aa(a,S(a))})):"visible"==f?Ba(a,c):(a.l.setScrollTop(Math.max(0,c-500)),a.onVisibleOnce(function(){Ba(a,S(a))}));M(a.h.getBody(),
"click",a.X.bind(a))}}else R(a,"not_found")}function S(a){var b=a.j;if(!b)return 0;a=a.l;for(var c=Number.MAX_VALUE,d=0,f=a.getPaddingTop(),e=0;e<b.length;e++){var g=a.getLayoutRect(b[e]),h=-f;if(0==h||0==g.width&&0==g.height)var k=g;else{k=g.left+0;h=g.top+h;var l=g.width;g=g.height;k={left:k,top:h,width:l,height:g,bottom:h+g,right:k+l,x:k,y:h}}g=k.bottom;c=Math.min(c,k.top);d=Math.max(d,g)}if(c>=d)return 0;b=a.getHeight()-f;b=(d+c-b)/2;b>c-80&&(b=c-80);return 0<b?b:0}
function Aa(a,b){R(a,"auto_scroll");a.l.setScrollTop(b);R(a,"shown")}
function Ba(a,b){a.l.setScrollTop(Math.max(0,b-500));var c=a.h.win.document.createElement("div");c.style.display="block";I(c,{position:"absolute",top:Math.floor(b)+"px",height:"1px",left:"0",width:"1px","pointer-events":"none"});var d=a.h.getBody();d.appendChild(c);R(a,"auto_scroll");a.l.animateScrollIntoView(c).then(function(){d.removeChild(c);var f=S(a);var e=a.l.getScrollTop();if(e==f&&e==b)f=null;else{var g={};e!=f&&(a.l.setScrollTop(f),g.nd=e-f);e!=b&&(g.od=e-b);f=g}R(a,"shown",f)})}
Q.prototype.setupMessaging=function(a){a.registerHandler("highlightDismiss",this.X.bind(this))};Q.prototype.X=function(){if(this.j)for(var a=0;a<this.j.length;a++)for(var b=this.j[a],c=["backgroundColor","color"],d=0;d<c.length;d++)H(b,c[d],null)};var Ca="key code location ctrlKey shiftKey altKey metaKey repeat isComposing charCode keyCode which".split(" ");function T(a,b){this.win=a;this.A=b;a=this.J.bind(this);K(this.win,"keydown",a,void 0);K(this.win,"keypress",a,void 0);K(this.win,"keyup",a,void 0)}T.prototype.J=function(a){Da(a)||this.I(a)};T.prototype.I=function(a){this.A.sendRequest(a.type,Ea(a),!1)};
function Da(a){if(a.defaultPrevented)return!0;if("Escape"==a.key)return!1;switch(a.target.nodeName){case "INPUT":return"checkbox"!=a.target.type||" "==a.key;case "TEXTAREA":case "BUTTON":case "SELECT":case "OPTION":return!0}return a.target.hasAttribute&&a.target.hasAttribute("contenteditable")}function Ea(a){var b={};Ca.forEach(function(c){void 0!==a[c]&&(b[c]=a[c])});return b};function Fa(a){if("string"!=typeof a)return a;if("{"!=a.charAt(0))return null;try{return JSON.parse(a)}catch(b){return null}}function U(a,b,c){this.o=a;this.O=b;this.$=c}U.prototype.addEventListener=function(a,b){var c=this;this.o.addEventListener("message",function(a){a.origin==c.O&&a.source==c.$&&b(a)})};U.prototype.postMessage=function(a){this.$.postMessage(a,"null"===this.O?"*":this.O)};U.prototype.start=function(){};
function V(a,b,c,d){this.o=a;this.P=b;this.fa=!!c;this.G=d||null;this.aa=!1;this.ga=0;this.V={};this.M={};this.W=null;this.P.addEventListener("message",this.da.bind(this));this.P.start()}V.prototype.registerHandler=function(a,b){this.M[a]=b};V.prototype.unregisterHandler=function(a){delete this.M[a]};V.prototype.setDefaultHandler=function(a){this.W=a};
V.prototype.da=function(a){if((a=Fa(a.data))&&"__AMPHTML__"===a.app)if(this.G&&this.aa&&a.messagingToken!==this.G)W(this,"amp-viewer-messaging: handleMessage_ error: ","invalid token");else if("q"===a.type)Ga(this,a);else if("s"===a.type){var b=a.requestid,c=this.V[b];c&&(delete this.V[b],a.error?(W(this,"amp-viewer-messaging: handleResponse_ error: ",a.error),c.reject(Error("Request "+a.name+" failed: "+a.error))):c.resolve(a.data))}};
V.prototype.sendRequest=function(a,b,c){var d=this,f=++this.ga,e=void 0;c&&(e=new Promise(function(a,b){d.V[f]={resolve:a,reject:b}}));X(this,{app:"__AMPHTML__",requestid:f,type:"q",name:a,data:b,rsvp:c});return e};function Ha(a,b,c,d){var f=d?d.message?d.message:String(d):"unknown error";W(a,"amp-viewer-messaging: sendResponseError_, message name: "+c,f);X(a,{app:"__AMPHTML__",requestid:b,type:"s",name:c,data:null,error:f})}
function X(a,b){var c=Object.assign(b,{});a.G&&!a.aa&&(c.messagingToken=a.G);a.P.postMessage(a.fa?JSON.stringify(c):c)}
function Ga(a,b){var c=a.M[b.name];c||(c=a.W);if(!c)throw c=Error("Cannot handle request because no default handler is set!"),c.args=b.name,c;c=c(b.name,b.data,!!b.rsvp);if(b.rsvp){var d=b.requestid;if(!c)throw Ha(a,d,b.name,Error("no response")),Error("expected response but none given: "+b.name);c.then(function(c){X(a,{app:"__AMPHTML__",requestid:d,type:"s",name:b.name,data:c})},function(c){Ha(a,d,b.name,c)})}}
function W(a,b,c){if(a.o){var d="amp-messaging-error-logger: "+b;d+=" data: "+(c?c.message?c.message:String(c):"unknown error");a.o.viewerState=d}};var Ia="altKey charCode ctrlKey detail eventPhase key layerX layerY metaKey pageX pageY returnValue shiftKey timeStamp type which".split(" "),Ja="clientX clientY force identifier pageX pageY radiusX radiusY screenX screenY".split(" ");function Y(a,b){this.win=a;this.A=b;this.R=!1;this.U=[];b.registerHandler("scrollLock",this.ha.bind(this));Ka(this)}
function Ka(a){var b=a.J.bind(a),c=a.win.document,d={capture:!1,passive:!a.R};a.U.push(K(c,"touchstart",b,d),K(c,"touchend",b,d),K(c,"touchmove",b,d))}function La(a){a.U.forEach(function(a){return a()});a.U.length=0}Y.prototype.J=function(a){switch(a.type){case "touchstart":case "touchend":case "touchmove":if(a&&a.type){var b=Ma(a,Ia);a.touches&&(b.touches=Na(a.touches));a.changedTouches&&(b.changedTouches=Na(a.changedTouches));this.A.sendRequest(a.type,b,!1)}this.R&&a.cancelable&&a.preventDefault()}};
function Na(a){for(var b=[],c=0;c<a.length;c++)b.push(Ma(a[c],Ja));return b}function Ma(a,b){for(var c={},d=0;d<b.length;d++){var f=b[d];void 0!==a[f]&&(c[f]=a[f])}return c}Y.prototype.ha=function(a,b,c){this.R=!!b;La(this);Ka(this);return c?Promise.resolve({}):void 0};function Z(a){this.win=a;this.Y=this.m=!1;this.K=null}
Z.prototype.init=function(){var a=this;v().fine("amp-viewer-integration","handshake init()");var b=D(this.win.document),c=C(b,"viewer");this.m="1"==c.getParam("webview");this.Y=c.hasCapability("handshakepoll");var d=c.getParam("messagingToken"),f=c.getParam("origin")||"";if(!this.m&&!f){m||(m=Promise.resolve(void 0));var e=m;return e}if(this.m||this.Y)return e=ma(this.win)?this.win.parent:null,Oa(this,e,f).then(function(e){return Pa(a,c,b,f,new V(a.win,e,a.m,d))});if(e=xa(b))this.K=new Q(b,e);e=new U(this.win,
f,this.win.parent);return Pa(this,c,b,f,new V(this.win,e,this.m,d))};
function Oa(a,b,c){return new Promise(function(d){var f=L(a.win,"message",function(e){v().fine("amp-viewer-integration","AMPDOC got a pre-handshake message:",e.type,e.data);var g=Fa(e.data);if(g&&e.origin===c&&e.source===b&&"__AMPHTML__"==g.app&&"handshake-poll"==g.name){if(a.m&&(!e.ports||!e.ports.length))throw Error("Did not receive communication port from the Viewer!");e=e.ports&&0<e.ports.length?e.ports[0]:new U(a.win,c,a.win.parent);d(e);f()}})})}
function Pa(a,b,c,d,f){v().fine("amp-viewer-integration","Send a handshake request");var e=c.getUrl(),g=la(e);return f.sendRequest("channelOpen",x({url:e,sourceUrl:g}),!0).then(function(){v().fine("amp-viewer-integration","Channel has been opened!");Qa(a,f,b,d)})}
function Qa(a,b,c,d){b.setDefaultHandler(function(a,b,d){return c.receiveMessage(a,b,d)});c.setMessageDeliverer(b.sendRequest.bind(b),d);M(a.win,"unload",a.ea.bind(a,b));(c.hasCapability("swipe")||c.hasCapability("touch"))&&new Y(a.win,b);c.hasCapability("keyboard")&&new T(a.win,b);c.hasCapability("focus-rect")&&new oa(a.win,b);null!=a.K&&a.K.setupMessaging(b)}Z.prototype.ea=function(a){return a.sendRequest("unloaded",{},!0)};(function(a){(new Z(a.win)).init()})(self.AMP);
})});

//# sourceMappingURL=amp-viewer-integration-0.1.js.map
