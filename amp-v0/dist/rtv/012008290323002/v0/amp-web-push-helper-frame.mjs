(function(){function f(a,b=""){try{return decodeURIComponent(a)}catch(c){return b}}let g=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function h(a){let b=Object.create(null);if(!a)return b;let c;for(;c=g.exec(a);){let a=f(c[1],c[1]),e=c[2]?f(c[2].replace(/\+/g," "),c[2]):"";b[a]=e}return b}let k="";let l=self.AMP_CONFIG||{},n=("string"==typeof l.cdnProxyRegex?new RegExp(l.cdnProxyRegex):l.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function p(a){if(self.document&&self.document.head&&(!self.location||!n.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}l.cdnUrl||p("runtime-host");l.geoApiUrl||p("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};let q=self.__AMP_LOG;function r(){if(q.dev)return q.dev;throw Error("failed to call initLogConstructor")}
/*
  https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
class t{constructor(a){this.M=a;this.D=this.J=0;this.A=Object.create(null)}has(a){return!!this.A[a]}get(a){let b=this.A[a];if(b)return b.access=++this.D,b.payload}put(a,b){this.has(a)||this.J++;this.A[a]={payload:b,access:this.D};if(!(this.J<=this.M)){a=this.A;var c=this.D+1;for(let b in a){let{access:e}=a[b];if(e<c){c=e;var d=b}}void 0!==d&&(delete a[d],this.J--)}}}(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0});let u,v;function x(a){u||(u=self.document.createElement("a"),v=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new t(100)));var b=v,c=u;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}class y{constructor(a){a||(a={debug:!1,windowContext:window});this.w={};this.m={};this.l=a.debug;this.B=this.N=this.O=!1;this.C=this.H=this.I=this.j=this.G=null;this.h=a.windowContext||window}listen(a){return new Promise((b,c)=>{this.B?c(Error("Already connected.")):this.O?c(Error("Already listening for connections.")):Array.isArray(a)?(this.I=this.W.bind(this,a,b,c),this.h.addEventListener("message",this.I),this.l&&r().fine("amp-web-push","Listening for a connection message...")):c(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",a))}).then(()=>{this.send(y.Topics.CONNECT_HANDSHAKE,null);this.B=!0})}W(a,b,c,d){let e=d.data,w=d.origin,B=d.ports;this.l&&r().fine("amp-web-push","Window message for listen() connection received:",e);a:{var m=x(w).origin;for(let b=0;b<a.length;b++)if(x(a[b]).origin===m){m=!0;break a}m=!1}m?e&&e.topic===y.Topics.CONNECT_HANDSHAKE?(r().fine("amp-web-push","Received expected connection handshake message:",e),this.h.removeEventListener("message",this.I),this.j=B[0],this.C=this.K.bind(this),this.j.addEventListener("message",this.C,!1),this.j.start(),b()):r().fine("amp-web-push","Discarding connection message because it did not contain our expected handshake:",e):r().fine("amp-web-push",`Discarding connection message from ${w} because it isn't an allowed origin:`,e," (allowed  origins are)",a)}connect(a,b){return new Promise((c,d)=>{a||d(Error("Provide a valid Window context to connect to."));b||d(Error("Provide an expected origin for the remote Window or provide the wildcard *."));this.B?d(Error("Already connected.")):this.N?d(Error("Already connecting.")):(this.G=new MessageChannel,this.j=this.G.port1,this.H=this.V.bind(this,this.j,b,c),this.j.addEventListener("message",this.H),this.j.start(),a.postMessage({topic:y.Topics.CONNECT_HANDSHAKE},"*"===b?"*":x(b).origin,[this.G.port2]),r().fine("amp-web-push",`Opening channel to ${b}...`))})}V(a,b,c){this.B=!0;this.l&&r().fine("amp-web-push",`Messenger channel to ${b} established.`);a.removeEventListener("message",this.H);this.C=this.K.bind(this);a.addEventListener("message",this.C,!1);c()}static get Topics(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}K(a){a=a.data;if(this.w[a.id]&&a.isReply){let b=this.w[a.id];delete this.w[a.id];let c=b.promiseResolver;b.message=a.data;this.l&&r().fine("amp-web-push","Received reply for topic '%s': %s",a.topic,a.data);c([a.data,this.L.bind(this,a.id,b.topic)])}else{let b=this.m[a.topic];if(b){this.l&&r().fine("amp-web-push",`Received new message for topic '${a.topic}': ${a.data}`);for(let c=0;c<b.length;c++)(0,b[c])(a.data,this.L.bind(this,a.id,a.topic))}}}on(a,b){this.m[a]?this.m[a].push(b):this.m[a]=[b]}off(a,b){if(b){let c=this.m[a].indexOf(b);-1!==c&&this.m[a].splice(c,1)}else this.m[a]&&delete this.m[a]}L(a,b,c){let d={id:a,topic:b,data:c,isReply:!0};this.j.postMessage(d);return new Promise(a=>{this.w[d.id]={message:c,topic:b,promiseResolver:a}})}send(a,b){let c={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:a,data:b};this.l&&r().fine("amp-web-push","Sending %s: %s",a,b);this.j.postMessage(c);return new Promise(d=>{this.w[c.id]={message:b,topic:a,promiseResolver:d}})}}function z(a,b){a({success:!0,error:void 0,result:b})}function A(a){let b=h(a.h.location.search);if(!b.parentOrigin)throw Error("Expecting parentOrigin URL query parameter.");return b.parentOrigin}function C(a){return a.h.navigator.serviceWorker&&a.h.navigator.serviceWorker.controller&&"activated"===a.h.navigator.serviceWorker.controller.state}class D{constructor(a){this.l=a&&a.debug;this.h=a.windowContext||window;this.o=new y({debug:this.l,windowContext:this.h});this.F={}}P(a,b){if(a&&a.isQueryTopicSupported){let c=!1;for(let b in y.Topics)a.isQueryTopicSupported===y.Topics[b]&&(c=!0);z(b,c)}else z(b,Notification.permission)}U(a,b){let c=null;try{if(a&&a.key&&this.h.localStorage)c=this.h.localStorage.getItem(a.key);else{if(!q.user)throw Error("failed to call initLogConstructor");q.user.warn("amp-web-push","LocalStorage retrieval failed.")}}catch(d){}z(b,c)}T(a,b){z(b,{isControllingFrame:!!this.h.navigator.serviceWorker.controller,url:this.h.navigator.serviceWorker.controller?this.h.navigator.serviceWorker.controller.scriptURL:null,state:this.h.navigator.serviceWorker.controller?this.h.navigator.serviceWorker.controller.state:null})}S(a,b){if(!a||!a.workerUrl||!a.registrationOptions)throw Error("Expected arguments workerUrl and registrationOptions in message, got:",a);this.h.navigator.serviceWorker.register(a.workerUrl,a.registrationOptions).then(()=>{z(b,null)}).catch(a=>{z(b,a?a.message||a.toString():null)})}messageServiceWorker(a){this.h.navigator.serviceWorker.controller.postMessage({command:a.topic,payload:a.payload})}R(a,b){if(!a||!a.topic)throw Error("Expected argument topic in message, got:",a);new Promise(b=>{this.F[a.topic]=b;this.waitUntilWorkerControlsPage().then(()=>{this.messageServiceWorker(a)})}).then(c=>{delete this.F[a.topic];return z(b,c)})}X(a){let b=a.data.payload,c=this.F[a.data.command];"function"===typeof c&&c(b)}waitUntilWorkerControlsPage(){return new Promise(a=>{C(this)?a():this.h.navigator.serviceWorker.addEventListener("controllerchange",()=>{C(this)?a():this.h.navigator.serviceWorker.controller.addEventListener("statechange",()=>{C(this)&&a()})})})}run(a){this.o.on(y.Topics.NOTIFICATION_PERMISSION_STATE,this.P.bind(this));this.o.on(y.Topics.SERVICE_WORKER_STATE,this.T.bind(this));this.o.on(y.Topics.SERVICE_WORKER_REGISTRATION,this.S.bind(this));this.o.on(y.Topics.SERVICE_WORKER_QUERY,this.R.bind(this));this.o.on(y.Topics.STORAGE_GET,this.U.bind(this));this.waitUntilWorkerControlsPage().then(()=>{this.h.navigator.serviceWorker.addEventListener("message",this.X.bind(this))});this.o.listen([a||A(this)])}}(function(a){let b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{{c=h(b.location.originalHash||b.location.hash);let a=h(b.location.search);k||(k=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"012008290323002");c={localDev:!1,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(c.development)||b.AMP_DEV_MODE),examiner:"2"==c.development,esm:!0,geoOverride:c["amp-geo"],minified:!0,lite:void 0!=a.amp_lite,test:!1,log:c.log,version:"2008290323002",rtvVersion:k}}c=b.__AMP_MODE=c}return c})().test||(window._ampWebPushHelperFrame=new D({debug:!1}),window._ampWebPushHelperFrame.run())})();