(self.AMP=self.AMP||[]).push({n:"amp-link-rewriter",v:"2008290323002",f:(function(AMP,_){
'use strict';var h="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function l(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object");})()}l(this);"function"===typeof Symbol&&Symbol("x");var r;
if("function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var t;a:{var u={a:!0},w={};try{w.__proto__=u;t=w.a;break a}catch(a){}t=!1}r=t?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var x=r;function y(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var A=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;var B=self.AMP_CONFIG||{},C=("string"==typeof B.cdnProxyRegex?new RegExp(B.cdnProxyRegex):B.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function D(a){if(self.document&&self.document.head&&(!self.location||!C.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}B.cdnUrl||D("runtime-host");B.geoApiUrl||D("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var E=self.__AMP_LOG;function F(a){E.user||(E.user=H());var b=E.user.win;return a&&a.ownerDocument.defaultView!=b?E.userForEmbed?E.userForEmbed:E.userForEmbed=H():E.user}function H(){throw Error("failed to call initLogConstructor");};var I=Object.prototype.hasOwnProperty;function J(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(n){if(E.dev)a=E.dev;else throw Error("failed to call initLogConstructor");a.warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var d=0;d<c.length;d++)0!=c[d].length&&("-"==c[d][0]?a[c[d].substr(1)]=!1:a[c[d]]=!0);return a};function K(a,b){var c=L(a);c=M(c);return N(c,b)}function L(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);a=N(b,"ampdoc").getAmpDoc(a)}return a}function M(a){a=L(a);return a.isSingleDoc()?a.win:a}function N(a,b){O(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function O(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var P;function Q(a){function b(a){return a}var c=R,d=a.dataset;a={};var n=c?c:/^param(.+)/,m;for(m in d){var p=m.match(n);p&&(p=p[1][0].toLowerCase()+p[1].substr(1),a[b(p)]=d[m])}return a}function S(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)};function T(a){var b={};Object.keys(a).forEach(function(c){b[c]="^"+a[c]+"$"});return b};function aa(a,b){var c=a.getRootNode(),d=b.section.join(" a, "),n=c.querySelectorAll("a"),m=[];0!==b.section.length&&(d+=" a",n=c.querySelectorAll(d));S(n,function(a){ba(a,b)&&m.push(a)});return m}function ba(a,b){var c=b.attribute;return Object.keys(c).every(function(b){return(new RegExp(c[b])).test(a.getAttribute(b))})};var ca=["href","id","rel","rev"],R=/^vars(.+)/,U=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,da={SOURCE_URL:!0,DOCUMENT_REFERRER:!0};
function V(a,b,c){this.j=c;try{/^[\w-]+$/.test("script");if(void 0!==P)var d=P;else{try{var n=b.ownerDocument,m=n.createElement("div"),p=n.createElement("div");m.appendChild(p);var k=m.querySelector(":scope div")===p}catch(G){k=!1}d=P=k}if(d)var f=b.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{b.classList.add("i-amphtml-scoped");var ea="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),fa=b.querySelectorAll(ea);b.classList.remove("i-amphtml-scoped");f=fa}var e=f;if(1!==e.length)throw Error("Found "+
e.length+" <script> children. Expected 1.");var z=e[0];if("SCRIPT"!=z.tagName||!z.hasAttribute("type")||"APPLICATION/JSON"!=z.getAttribute("type").toUpperCase())throw Error('<script> child must have type="application/json"');try{var q=JSON.parse(z.textContent)}catch(G){throw Error("Failed to parse <script> contents. Is it valid JSON?");}var v=q}catch(G){throw F(b).createError("%s: %s","amp-link-rewriter",G);}c=v;v=c.output;F().assert(v,"amp-link-rewriter: output config property is required",void 0,
void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0);this.l={output:c.output.toString(),section:I.call(c,"section")?c.section:[],attribute:I.call(c,"attribute")?T(c.attribute):{},vars:I.call(c,"vars")?c.vars:{}};this.m=aa(this.j,this.l);this.h=a;this.c="";c=b.ownerDocument.defaultView;e=c.__AMP_TOP||(c.__AMP_TOP=c);v=c!=e;if(e.__AMP__EXPERIMENT_TOGGLES)var g=e.__AMP__EXPERIMENT_TOGGLES;else{e.__AMP__EXPERIMENT_TOGGLES=Object.create(null);q=e.__AMP__EXPERIMENT_TOGGLES;if(e.AMP_CONFIG)for(g in e.AMP_CONFIG)f=
e.AMP_CONFIG[g],"number"===typeof f&&0<=f&&1>=f&&(q[g]=Math.random()<f);if(e.AMP_CONFIG&&Array.isArray(e.AMP_CONFIG["allow-doc-opt-in"])&&0<e.AMP_CONFIG["allow-doc-opt-in"].length&&(g=e.AMP_CONFIG["allow-doc-opt-in"],f=e.document.head.querySelector('meta[name="amp-experiments-opt-in"]')))for(f=f.getAttribute("content").split(","),d=0;d<f.length;d++)-1!=g.indexOf(f[d])&&(q[f[d]]=!0);Object.assign(q,J(e));if(e.AMP_CONFIG&&Array.isArray(e.AMP_CONFIG["allow-url-opt-in"])&&0<e.AMP_CONFIG["allow-url-opt-in"].length){g=
e.AMP_CONFIG["allow-url-opt-in"];f=e.location.originalHash||e.location.hash;e=Object.create(null);if(f)for(;k=A.exec(f);)d=y(k[1],k[1]),k=k[2]?y(k[2].replace(/\+/g," "),k[2]):"",e[d]=k;for(f=0;f<g.length;f++)d=e["e-"+g[f]],"1"==d&&(q[g[f]]=!0),"0"==d&&(q[g[f]]=!1)}g=q}g=!!g["ampdoc-fie"];v&&!g?g=O(c,"url-replace")?N(c,"url-replace"):null:(g=L(b),g=M(g),g=O(g,"url-replace")?N(g,"url-replace"):null);this.A=g}
V.prototype.handleClick=function(a){if(a&&(this.c=this.l.output,a.href.match(U)[1]!==this.c.match(U)[1]&&ha(this,a))){var b=K(this.j,"documentInfo").get().sourceUrl.match(U)[1],c=K(this.j,"documentInfo").get().canonicalUrl.match(U)[1];if(!ia(a,[b,c])){this.c=this.A.expandUrlSync(this.c,{DOCUMENT_REFERRER:this.h},da);var d=this.l.vars;d instanceof Object&&(a.href=ja(this,a,d))}}};function ha(a,b){return null===a.m||0===a.m.length||0<a.m.filter(function(a){return a===b}).length?!0:!1}
function ia(a,b){var c=a.href;return b.some(function(a){var b=c.match(U);return b?U.test(c)&&b[1]===a:!0})}function ja(a,b,c){ca.forEach(function(a){b.getAttribute(a)&&(c[a]=b.getAttribute(a))});var d=Q(b);Object.assign(c,d);c.random=Math.random().toString(32).substr(2);Object.keys(c).forEach(function(b){c[b]&&(a.c=a.c.replace("${"+b+"}",encodeURIComponent(c[b])))});a.c=a.c.replace(/\${[A-Za-z0-9]+}+/,function(){return""});return a.c};function W(a){a=AMP.BaseElement.call(this,a)||this;a.o=null;a.h="";return a}var X=AMP.BaseElement;W.prototype=h(X.prototype);W.prototype.constructor=W;if(x)x(W,X);else for(var Y in X)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(X,Y);Z&&Object.defineProperty(W,Y,Z)}else W[Y]=X[Y];W.B=X.prototype;
W.prototype.buildCallback=function(){var a=this,b=K(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then(function(){return b.getReferrerUrl()}).then(function(b){return a.h=b}).then(this.w.bind(this))};W.prototype.w=function(){this.o=new V(this.h,this.element,this.getAmpDoc());ka(this)};function ka(a){K(a.getAmpDoc(),"navigation").registerAnchorMutator(function(b){a.o.handleClick(b)},0)}W.prototype.isLayoutSupported=function(a){return"nodisplay"===a};
(function(a){a.registerElement("amp-link-rewriter",W)})(self.AMP);
})});

//# sourceMappingURL=amp-link-rewriter-0.1.js.map
