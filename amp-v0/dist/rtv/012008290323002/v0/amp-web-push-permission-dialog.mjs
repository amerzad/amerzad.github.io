(function(){function f(a,b=""){try{return decodeURIComponent(a)}catch(c){return b}}let g=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function h(a){let b=Object.create(null);if(!a)return b;let c;for(;c=g.exec(a);){let a=f(c[1],c[1]),e=c[2]?f(c[2].replace(/\+/g," "),c[2]):"";b[a]=e}return b}let k="";let m=self.AMP_CONFIG||{},n=("string"==typeof m.cdnProxyRegex?new RegExp(m.cdnProxyRegex):m.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function p(a){if(self.document&&self.document.head&&(!self.location||!n.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}m.cdnUrl||p("runtime-host");m.geoApiUrl||p("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};let q=self.__AMP_LOG;function r(){if(q.dev)return q.dev;throw Error("failed to call initLogConstructor")}
/*
  https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
class t{constructor(a){this.L=a;this.C=this.H=0;this.w=Object.create(null)}has(a){return!!this.w[a]}get(a){let b=this.w[a];if(b)return b.access=++this.C,b.payload}put(a,b){this.has(a)||this.H++;this.w[a]={payload:b,access:this.C};if(!(this.H<=this.L)){a=this.w;var c=this.C+1;for(let b in a){let{access:e}=a[b];if(e<c){c=e;var d=b}}void 0!==d&&(delete a[d],this.H--)}}}(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0});let u,v;function x(a){u||(u=self.document.createElement("a"),v=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new t(100)));var b=v,c=u;if(b&&b.has(a))a=b.get(a);else{c.href=a;c.protocol||(c.href=c.href);var d={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=c.origin&&"null"!=c.origin?c.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;b&&b.put(a,d);a=d}return a}class y{constructor(a){a||(a={debug:!1,windowContext:window});this.o={};this.m={};this.l=a.debug;this.A=this.M=this.N=!1;this.B=this.F=this.G=this.j=this.D=null;this.h=a.windowContext||window}listen(a){return new Promise((b,c)=>{this.A?c(Error("Already connected.")):this.N?c(Error("Already listening for connections.")):Array.isArray(a)?(this.G=this.P.bind(this,a,b,c),this.h.addEventListener("message",this.G),this.l&&r().fine("amp-web-push","Listening for a connection message...")):c(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",a))}).then(()=>{this.send(y.Topics.CONNECT_HANDSHAKE,null);this.A=!0})}P(a,b,c,d){let e=d.data,w=d.origin,C=d.ports;this.l&&r().fine("amp-web-push","Window message for listen() connection received:",e);a:{var l=x(w).origin;for(let b=0;b<a.length;b++)if(x(a[b]).origin===l){l=!0;break a}l=!1}l?e&&e.topic===y.Topics.CONNECT_HANDSHAKE?(r().fine("amp-web-push","Received expected connection handshake message:",e),this.h.removeEventListener("message",this.G),this.j=C[0],this.B=this.J.bind(this),this.j.addEventListener("message",this.B,!1),this.j.start(),b()):r().fine("amp-web-push","Discarding connection message because it did not contain our expected handshake:",e):r().fine("amp-web-push",`Discarding connection message from ${w} because it isn't an allowed origin:`,e," (allowed  origins are)",a)}connect(a,b){return new Promise((c,d)=>{a||d(Error("Provide a valid Window context to connect to."));b||d(Error("Provide an expected origin for the remote Window or provide the wildcard *."));this.A?d(Error("Already connected.")):this.M?d(Error("Already connecting.")):(this.D=new MessageChannel,this.j=this.D.port1,this.F=this.O.bind(this,this.j,b,c),this.j.addEventListener("message",this.F),this.j.start(),a.postMessage({topic:y.Topics.CONNECT_HANDSHAKE},"*"===b?"*":x(b).origin,[this.D.port2]),r().fine("amp-web-push",`Opening channel to ${b}...`))})}O(a,b,c){this.A=!0;this.l&&r().fine("amp-web-push",`Messenger channel to ${b} established.`);a.removeEventListener("message",this.F);this.B=this.J.bind(this);a.addEventListener("message",this.B,!1);c()}static get Topics(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}J(a){a=a.data;if(this.o[a.id]&&a.isReply){let b=this.o[a.id];delete this.o[a.id];let c=b.promiseResolver;b.message=a.data;this.l&&r().fine("amp-web-push","Received reply for topic '%s': %s",a.topic,a.data);c([a.data,this.K.bind(this,a.id,b.topic)])}else{let b=this.m[a.topic];if(b){this.l&&r().fine("amp-web-push",`Received new message for topic '${a.topic}': ${a.data}`);for(let c=0;c<b.length;c++)(0,b[c])(a.data,this.K.bind(this,a.id,a.topic))}}}on(a,b){this.m[a]?this.m[a].push(b):this.m[a]=[b]}off(a,b){if(b){let c=this.m[a].indexOf(b);-1!==c&&this.m[a].splice(c,1)}else this.m[a]&&delete this.m[a]}K(a,b,c){let d={id:a,topic:b,data:c,isReply:!0};this.j.postMessage(d);return new Promise(a=>{this.o[d.id]={message:c,topic:b,promiseResolver:a}})}send(a,b){let c={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:a,data:b};this.l&&r().fine("amp-web-push","Sending %s: %s",a,b);this.j.postMessage(c);return new Promise(d=>{this.o[c.id]={message:b,topic:a,promiseResolver:d}})}}function z(a){let b=a.h.document.querySelector("#close");b&&b.addEventListener("click",()=>{a.closeDialog()})}function A(a){a.h.localStorage.setItem("amp-web-push-notification-permission",a.h.Notification.permission)}function B(a){a.requestNotificationPermission().then(b=>{A(a);if(a.isCurrentDialogPopup())return a.I.connect(opener,"*"),a.I.send(y.Topics.NOTIFICATION_PERMISSION_STATE,b).then(b=>{(b=b[0])&&b.closeFrame&&a.closeDialog()});a.closeDialog()})}function D(a){navigator.permissions.query({name:"notifications"}).then(b=>{b.onchange=()=>{A(a);switch(a.h.Notification.permission){case"default":case"granted":B(a)}}})}function E(a,b){a&&(b?a.classList.remove("invisible"):a.classList.add("invisible"))}class F{constructor(a){this.l=a&&a.debug;this.h=a.windowContext||window;this.I=new y({debug:this.l,windowContext:this.h})}isCurrentDialogPopup(){return!!this.h.opener&&this.h.opener!==this.h}requestNotificationPermission(){return new Promise((a,b)=>{try{this.h.Notification.requestPermission(b=>a(b))}catch(c){b(c)}})}run(){z(this);A(this);var a=this.h.document.querySelectorAll("[permission]");for(var b=0;b<a.length;b++)E(a[b],!1);(a=this.h.document.querySelector(`[permission=${CSS.escape(this.h.Notification.permission)}]`))&&E(a,!0);a=this.h.document.querySelector("#preload");b=this.h.document.querySelector("#postload");a&&b&&(E(a,!1),E(b,!0));"denied"!==this.h.Notification.permission?B(this):D(this)}closeDialog(){if(this.isCurrentDialogPopup())this.h.close();else{let b=h((this.h.fakeLocation||this.h.location).search);if(!b["return"])throw Error("Missing required parameter.");var a=f(b["return"],void 0);this.redirectToUrl(a)}}redirectToUrl(a){let b=x(a);!b||"http:"!==b.protocol&&"https:"!==b.protocol||(this.h.location.href=a)}}(function(a){let b=a||self;if(b.__AMP_MODE)var c=b.__AMP_MODE;else{{c=h(b.location.originalHash||b.location.hash);let a=h(b.location.search);k||(k=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"012008290323002");c={localDev:!1,development:!!(0<=["1","actions","amp","amp4ads","amp4email"].indexOf(c.development)||b.AMP_DEV_MODE),examiner:"2"==c.development,esm:!0,geoOverride:c["amp-geo"],minified:!0,lite:void 0!=a.amp_lite,test:!1,log:c.log,version:"2008290323002",rtvVersion:k}}c=b.__AMP_MODE=c}return c})().test||(window._ampWebPushPermissionDialog=new F({debug:!1}),window._ampWebPushPermissionDialog.run())})();