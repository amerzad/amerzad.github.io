(self.AMP=self.AMP||[]).push({n:"amp-smartlinks",v:"2008290323002",f:function(AMP,_){class h{constructor(){let a,b;this.promise=new Promise((c,d)=>{a=c;b=d});this.resolve=a;this.reject=b}}let k=self.AMP_CONFIG||{},l=("string"==typeof k.cdnProxyRegex?new RegExp(k.cdnProxyRegex):k.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function m(a){if(self.document&&self.document.head&&(!self.location||!l.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}k.cdnUrl||m("runtime-host");k.geoApiUrl||m("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};let n=self.__AMP_LOG;function p(a){return a||{}}p({c:!0,v:!0,a:!0,ad:!0});function q(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return r(a,b)}function t(a,b){var c=u(a);c=v(c);return r(c,b)}function u(a){return a.nodeType?q((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function v(a){a=u(a);return a.isSingleDoc()?a.win:a}function r(a,b){a=w(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function x(a,b){let c=y(a,b);if(c)return c;a=w(a);a[b]=z();return a[b].promise}function y(a,b){let c=w(a)[b];if(c){if(c.promise)return c.promise;r(a,b);return c.promise=Promise.resolve(c.obj)}return null}function w(a){let b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function z(){let a=new h,b=a.promise,c=a.resolve,d=a.reject;b.catch(()=>{});return{obj:null,promise:b,resolve:c,reject:d,context:null,ctor:null}}let A;function B(){return A?A:A=Promise.resolve(void 0)}
/*
    https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function C(a,b,c){a=a.createElement(b);for(let b in c)a.setAttribute(b,c[b]);return a}function D(a){let b=y(v(a),"amp-analytics-instrumentation");if(b)return b;let c=u(a);return c.waitForBodyOpen().then(()=>{var a=c.win;var b=c.win.document.head;if(b){var f={};b=b.querySelectorAll("script[custom-element],script[custom-template]");for(let a=0;a<b.length;a++){var g=b[a];g=g.getAttribute("custom-element")||g.getAttribute("custom-template");f[g]=!0}f=Object.keys(f)}else f=[];return f.includes("amp-analytics")?q(a,"extensions").waitForExtension(a,"amp-analytics"):B()}).then(()=>{var b=c.win;return b.__AMP_EXTENDED_ELEMENTS&&b.__AMP_EXTENDED_ELEMENTS["amp-analytics"]?x(v(a),"amp-analytics-instrumentation"):null})}function F(a,b,c={}){D(a).then(d=>{d&&d.triggerEventForTarget(a,b,c,!1)})}class G{constructor(a,b){this.T=a.getResourceId();this.G=a;this.B=b;for(let a in b.triggers)b.triggers[a].on=`sandbox-${this.T}-${b.triggers[a].on}`;this.G.signals().whenSignal("load-start").then(()=>{{var a=this.G,d=a.ownerDocument;let c=C(d,"amp-analytics",p({sandbox:"true",trigger:"immediate"}));d=C(d,"script",p({type:"application/json"}));d.textContent=JSON.stringify(b);c.appendChild(d);c.CONFIG=b;{d=q(a.ownerDocument.defaultView,"extensions");let b=u(a);d.installExtensionForDoc(b,"amp-analytics")}a.appendChild(c)}})}trigger(a,b){F(this.G,`sandbox-${this.T}-${a}`,b)}}class H{constructor(a){this.G=a;this.B={requests:{},triggers:{}}}setTransportConfig(a){this.B.transport=a}setExtraUrlParams(a){this.B.extraUrlParams=a}track(a,b){b=Array.isArray(b)?b:[b];let c=[];for(let d=0;d<b.length;d++){let e=`${a}-request-${d}`;this.B.requests[e]=b[d];c.push(e)}this.B.triggers[a]={on:a,request:c};return this}build(){let a=new G(this.G,this.B);this.B=null;return a}}let I;let J="Webkit webkit Moz moz ms O o".split(" ");let K=!1;class L{constructor(){this.l=[]}peek(){let a=this.l.length;return a?this.l[a-1].item:null}enqueue(a,b){if(isNaN(b))throw Error("Priority must not be NaN.");{var c=-1;let a=0,e=this.l.length;for(;a<=e;){c=Math.floor((a+e)/2);if(c===this.l.length)break;if(this.l[c].priority<b)a=c+1;else if(0<c&&this.l[c-1].priority>=b)e=c-1;else break}}this.l.splice(c,0,{item:a,priority:b})}forEach(a){let b=this.l.length;for(;b--;)a(this.l[b].item)}dequeue(){return this.l.length?this.l.pop().item:null}get length(){return this.l.length}}let M=/nochunking=1/.test(self.location.hash);let N=B();function O(a,b){if(M)N.then(b);else{var c=P,d=u(a);{var e=v(d);let a=w(e);let b=a.chunk;b||(b=a.chunk={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null});b.ctor||b.obj||(b.ctor=c,b.context=d,b.resolve&&r(e,"chunk"))}t(a,"chunk").run(b,10)}}function Q(a,b){if("run"!=a.state){a.state="run";try{a.L(b)}catch(c){throw a.X(),c}}}class R{constructor(a){this.state="not_run";this.L=a}ia(){return this.L.displayName||this.L.name}X(){}U(){return!1}$(){return!1}}class S extends R{constructor(a,b,c){super(a);this.P=c}X(){var a=self.document;if(!K){K=!0;a=a.body;var b={opacity:1,visibility:"visible",animation:"none"};for(let E in b){var c=a,d=b[E];a:{var e=c.style;var f=E;if(2>f.length?0:0==f.lastIndexOf("--",0)){e=f;break a}I||(I=Object.create(null));let a=I[f];if(!a){a=f;if(void 0===e[f]){var g=f;g=g.charAt(0).toUpperCase()+g.slice(1);b:{for(let a=0;a<J.length;a++){let b=J[a]+g;if(void 0!==e[b]){g=b;break b}}g=""}void 0!==e[g]&&(a=g)}I[f]=a}e=a}e&&((2>e.length?0:0==e.lastIndexOf("--",0))?c.style.setProperty(e,d):c.style[e]=d)}}}U(){return this.P.ampdoc.isVisible()}$(){return this.P.R}}function T(a){if(!a.K){var b=U(a);b&&(b.U()?(a.K=!0,V(a)):b.$()&&a.D.requestIdleCallback?aa(a.D,a.O):W(a))}}function U(a,b){let c=a.C.peek();for(;c&&"not_run"!==c.state;)a.C.dequeue(),c=a.C.peek();c&&b&&a.C.dequeue();return c}function W(a){a.D.postMessage("amp-macro-task","*")}function V(a){a.aa&&5<a.F?(a.F=0,W(a)):N.then(()=>{a.O(null)})}class P{constructor(a){this.ampdoc=a;this.D=a.win;this.C=new L;this.O=this.S.bind(this);this.F=0;this.K=!1;this.aa=this.D.document.documentElement.hasAttribute("i-amphtml-no-boilerplate");this.D.addEventListener("message",a=>{"amp-macro-task"==a.data&&this.S(null)});this.R=!1;x(v(a),"viewer").then(()=>{this.R=!0});a.onVisibilityChanged(()=>{a.isVisible()&&T(this)})}run(a,b){a=new R(a);this.C.enqueue(a,b);T(this)}runForStartup(a){a=new S(a,this.D,this);this.C.enqueue(a,Number.POSITIVE_INFINITY);T(this)}S(a){let b=U(this,!0);if(!b)return this.K=!1,this.F=0,!1;let c;try{c=Date.now(),Q(b,a)}finally{N.then().then().then().then().then().then().then().then().then(()=>{this.K=!1;this.F+=Date.now()-c;T(this)})}return!0}}function aa(a,b){function c(e){if(15>e.timeRemaining()){let f=2e3-(Date.now()-d);0>=f||e.didTimeout?b(e):a.requestIdleCallback(c,{timeout:f})}else b(e)}let d=Date.now();a.requestIdleCallback(c,{timeout:2e3})}class ba{constructor(){this.m=[];this.N=[]}updateLinkList(a){this.N=a.map(this.getReplacementUrlForAnchor.bind(this));this.m=a}updateReplacementUrls(a){a.forEach(a=>{let b=a.replacementUrl,d=this.m.indexOf(a.anchor);-1!==d&&(this.N[d]=b)})}getReplacementUrlForAnchor(a){a=this.m.indexOf(a);return-1!==a?this.N[a]:null}isInCache(a){return-1!==this.m.indexOf(a)}getAnchorReplacementList(){return this.m.map(a=>({anchor:a,replacementUrl:this.getReplacementUrlForAnchor(a)}))}}class ca{constructor(){this.j=null}add(a){this.j||(this.j=[]);this.j.push(a);return()=>{this.remove(a)}}remove(a){this.j&&(a=this.j.indexOf(a),-1<a&&this.j.splice(a,1))}removeAll(){this.j&&(this.j.length=0)}fire(a){if(this.j){var b=this.j;for(let c=0;c<b.length;c++)(0,b[c])(a)}}getHandlerCount(){return this.j?this.j.length:0}}class X{constructor(a,b){this.syncResponse=a;this.asyncResponse=b}}function da(a){let b=ea(a),c=fa(a,b);a.A.updateLinkList(b);if(!c.length)return B();a.A.updateReplacementUrls(c.map(a=>({anchor:a,replacementUrl:null})));let d=a.ga(c);if(!n.user)throw Error("failed to call initLogConstructor");n.user.assert(d instanceof X,'Invalid response from provided "resolveUnknownLinks" function."resolveUnknownLinks" should return an instance of TwoStepsResponse',void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0);d.syncResponse&&a.A.updateReplacementUrls(d.syncResponse);return d.asyncResponse?d.asyncResponse.then(b=>{a.A.updateReplacementUrls(b)}):B()}function ea(a){let b=a.w.querySelectorAll(a.ba);return[].slice.call(b)}function fa(a,b){let c=[];b.forEach(b=>{a.isWatchingLink(b)||c.push(b)});return c}class ha{constructor(a,b,c,d){this.events=new ca;this.id=b;this.w=a;this.ga=c;this.ba=d.linkSelector||"a";this.ha=300;this.A=new ba}getReplacementUrl(a){return this.isWatchingLink(a)?this.A.getReplacementUrlForAnchor(a):null}getAnchorReplacementList(){return this.A.getAnchorReplacementList()}isWatchingLink(a){return this.A.isInCache(a)}rewriteAnchorUrl(a){let b=this.getReplacementUrl(a);if(!b||b===a.href)return!1;a.setAttribute("data-link-rewriter-original-url",a.href);a.href=b;setTimeout(()=>{a.href=a.getAttribute("data-link-rewriter-original-url");a.removeAttribute("data-link-rewriter-original-url")},this.ha);return!0}onDomUpdated(){return new Promise(a=>{O(this.w.nodeType==Node.DOCUMENT_NODE?this.w.documentElement:this.w,()=>da(this).then(()=>{this.events.fire({type:"PAGE_SCANNED"});a()}))})}}function Y(a,b,c){a.push(b);a.sort((a,b)=>{let d=c.indexOf(a.id),e=c.indexOf(b.id);return-1===d&&-1===e?0:-1===d?1:-1===e?-1:d>e?1:-1})}function ia(a,b){let c=ja(b);return a.M.reduce((a,e)=>{e.isWatchingLink(b)&&Y(a,e,c);return a},[])}function ja(a){let b=a.hasAttribute("data-link-rewriters")?a.getAttribute("data-link-rewriters").trim():null;return b?b.split(/\s+/):[]}class ka{constructor(a){this.w=a.getRootNode();var b;this.da=b=(b=a.getMetaByName("amp-link-rewriter-priorities"))?b.trim().split(/\s+/):[];this.M=[];this.w.addEventListener("amp:dom-update",this.ca.bind(this));t(a,"navigation").registerAnchorMutator(this.maybeRewriteLink.bind(this),0)}registerLinkRewriter(a,b,c){let d=new ha(this.w,a,b,c);Y(this.M,d,this.da);d.onDomUpdated();return d}maybeRewriteLink(a,b){let c=ia(this,a);if(c.length){let d=null;for(let b=0;b<c.length;b++)if(c[b].rewriteAnchorUrl(a)){d=c[b];break}let e={linkRewriterId:d?d.id:null,anchor:a,clickType:b.type};c.forEach(a=>{a.events.fire({type:"CLICK",eventData:e})})}}ca(){this.M.forEach(a=>{a.onDomUpdated()})}}function la(a,b){if(!isFinite(5))throw Error("Invalid depth: 5");if(a===b)return!0;for(a=[{a:a,b:b,depth:5}];0<a.length;){let{a:c,b:d,depth:e}=a.shift();if(0<e){if(typeof c!==typeof d)return!1;if(Array.isArray(c)&&Array.isArray(d)){if(c.length!==d.length)return!1;for(b=0;b<c.length;b++)a.push({a:c[b],b:d[b],depth:e-1});continue}else if(c&&d&&"object"===typeof c&&"object"===typeof d){let f=Object.keys(c),g=Object.keys(d);if(f.length!==g.length)return!1;for(b=0;b<f.length;b++){let g=f[b];a.push({a:c[g],b:d[g],depth:e-1})}continue}}if(c!==d)return!1}return!0}function Z(a){let b=[];a.m.forEach(c=>{a.J.forEach(d=>{c.getAttribute(a.I)===d.url&&d.auction_id&&b.push({anchor:c,replacementUrl:`https://shop-links.co/${d.auction_id}/?amp=true`})})});return b}function ma(a,b){let c=na(a,b),d=p({name:a.w.title||null,url:a.h.getUrl()});b=p({article:d,links:c});let e="https://api.narrativ.com/api/v1/publishers/.pub_id./linkmate/smart_links/".replace(".pub_id.",a.ea.toString()),f={method:"POST",ampCors:!1,headers:p({"Content-Type":"application/json"}),body:b};return a.H.fetchJson(e,f).then(a=>a.json())}function na(a,b){let c=[];b.forEach(b=>{let d=b.getAttribute(a.I);if(/shop-links.co/.test(d))/\?amp=true$/.test(d)||(b[a.I]=`${b[a.I]}?amp=true`);else if(!/#donotlink$/.test(d)){let b=a.fa||/#locklink$/.test(d);c.push({raw_url:d,exclusive_match_requested:b,link_source:"linkmate"})}});return c}class oa{constructor(a,b,c){this.h=a;this.H=b;this.fa=c.exclusiveLinks;this.ea=c.publisherID;this.I=c.linkAttribute;this.w=this.h.getRootNode();this.J=this.m=null}runLinkmate(a){let b=null;let c=this.m&&!la(this.m,a);this.J&&c&&(b=Z(this));if(!this.J||c){let c=ma(this,a).then(b=>{this.J=b.data[0].smart_links;this.m=a;return Z(this)});return new X(b,c)}this.m=a;return new X(b,null)}}function pa(a){var b=a.getAttribute("nrtv-account-name").toLowerCase(),c=!!a.hasAttribute("linkmate"),d=!!a.hasAttribute("exclusive-links");var e=(e=a.getAttribute("link-attribute"))?e.toLowerCase():"href";a=(a=a.getAttribute("link-selector"))?a.toLowerCase():"a";return{nrtvSlug:b,linkmateEnabled:c,exclusiveLinks:d,linkAttribute:e,linkSelector:a}}function qa(a){ra(a).then(b=>{a.o.linkmateExpected=b.linkmate_enabled;a.o.publisherID=b.publisher_id;{a.signals().signal("load-start");b=p({events:[{is_amp:!0}],organization_id:a.o.publisherID,organization_type:"publisher",user:{page_session_uuid:sa(),source_url:a.h.getUrl(),previous_url:a.Y,user_agent:a.h.win.navigator.userAgent}});let c=new H(a.element);c.track("page-impression","https://api.narrativ.com/api/v1/events/impressions/page_impression/");c.setTransportConfig(p({beacon:!0,image:!1,xhrpost:!0,useBody:!0}));c.setExtraUrlParams(b);c.build().trigger("page-impression")}a.W=new oa(a.h,a.H,a.o);a.Z=ta(a);a.o.linkmateEnabled&&a.o.linkmateExpected&&a.Z.getAnchorReplacementList()})}function ra(a){let b="https://api.narrativ.com/api/v0/publishers/.nrtv_slug./amp_config/".replace(".nrtv_slug.",a.o.nrtvSlug);try{return a.H.fetchJson(b,{method:"GET",ampCors:!1}).then(a=>a.json()).then(a=>a.data[0].amp_config)}catch(c){return null}}function ta(a){return a.V.registerLinkRewriter("amp-smartlinks",b=>a.W.runLinkmate(b),{linkSelector:a.o.linkSelector})}function sa(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16))}class ua extends AMP.BaseElement{constructor(a){super(a);this.Y=this.W=this.o=this.Z=this.V=this.h=this.H=null}buildCallback(){this.h=this.getAmpDoc();this.H=q(this.h.win,"xhr");let a=t(this.h,"viewer");this.o=pa(this.element);this.V=new ka(this.h);return this.h.whenReady().then(()=>a.getReferrerUrl()).then(a=>{this.Y=a;this.h.whenFirstVisible().then(()=>{qa(this)})})}}(a=>{a.registerElement("amp-smartlinks",ua)})(self.AMP)}});